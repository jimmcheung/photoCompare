import{r as b,a as Br,g as ar,R as te,b as yt}from"./vendor-Dja1Ap5q.js";import{h as $r,v as lr}from"./heic-kq-hUwqs.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var cr={exports:{}},Lt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wr=b,Hr=Symbol.for("react.element"),zr=Symbol.for("react.fragment"),Vr=Object.prototype.hasOwnProperty,Gr=Wr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_r={key:!0,ref:!0,__self:!0,__source:!0};function dr(n,e,t){var r,i={},o=null,a=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)Vr.call(e,r)&&!_r.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Hr,type:n,key:o,ref:a,props:i,_owner:Gr.current}}Lt.Fragment=zr;Lt.jsx=dr;Lt.jsxs=dr;cr.exports=Lt;var s=cr.exports,en={},Fn=Br;en.createRoot=Fn.createRoot,en.hydrateRoot=Fn.hydrateRoot;const Xr={},Dn=n=>{let e;const t=new Set,r=(d,g)=>{const m=typeof d=="function"?d(e):d;if(!Object.is(m,e)){const S=e;e=g??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(j=>j(e,S))}},i=()=>e,c={setState:r,getState:i,getInitialState:()=>h,subscribe:d=>(t.add(d),()=>t.delete(d)),destroy:()=>{(Xr?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},h=e=n(r,i,c);return c},Yr=n=>n?Dn(n):Dn;var ur={exports:{}},hr={},fr={exports:{}},gr={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ct=b;function Kr(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Jr=typeof Object.is=="function"?Object.is:Kr,qr=ct.useState,Zr=ct.useEffect,Qr=ct.useLayoutEffect,ei=ct.useDebugValue;function ti(n,e){var t=e(),r=qr({inst:{value:t,getSnapshot:e}}),i=r[0].inst,o=r[1];return Qr(function(){i.value=t,i.getSnapshot=e,_t(i)&&o({inst:i})},[n,t,e]),Zr(function(){return _t(i)&&o({inst:i}),n(function(){_t(i)&&o({inst:i})})},[n]),ei(t),t}function _t(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Jr(n,t)}catch{return!0}}function ni(n,e){return e()}var ri=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ni:ti;gr.useSyncExternalStore=ct.useSyncExternalStore!==void 0?ct.useSyncExternalStore:ri;fr.exports=gr;var ii=fr.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rt=b,si=ii;function oi(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var ai=typeof Object.is=="function"?Object.is:oi,li=si.useSyncExternalStore,ci=Rt.useRef,di=Rt.useEffect,ui=Rt.useMemo,hi=Rt.useDebugValue;hr.useSyncExternalStoreWithSelector=function(n,e,t,r,i){var o=ci(null);if(o.current===null){var a={hasValue:!1,value:null};o.current=a}else a=o.current;o=ui(function(){function c(S){if(!h){if(h=!0,d=S,S=r(S),i!==void 0&&a.hasValue){var j=a.value;if(i(j,S))return g=j}return g=S}if(j=g,ai(d,S))return j;var X=r(S);return i!==void 0&&i(j,X)?(d=S,j):(d=S,g=X)}var h=!1,d,g,m=t===void 0?null:t;return[function(){return c(e())},m===null?void 0:function(){return c(m())}]},[e,t,r,i]);var l=li(n,o[0],o[1]);return di(function(){a.hasValue=!0,a.value=l},[l]),hi(l),l};ur.exports=hr;var fi=ur.exports;const gi=ar(fi),pr={},{useDebugValue:pi}=te,{useSyncExternalStoreWithSelector:mi}=gi;let Ln=!1;const xi=n=>n;function yi(n,e=xi,t){(pr?"production":void 0)!=="production"&&t&&!Ln&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Ln=!0);const r=mi(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return pi(r),r}const Rn=n=>{(pr?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof n=="function"?Yr(n):n,t=(r,i)=>yi(e,r,i);return Object.assign(t,e),t},hn=n=>n?Rn(n):Rn,Le=hn(n=>({darkMode:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,syncZoom:!0,syncDraw:!1,presentationMode:!1,visibleExifFields:["Make","Model","ISO","FNumber","ExposureTime","FocalLength","LensModel","DateTimeOriginal"],demoMode:!1,exifSettings:{FileName:!1,Resolution:!0,Make:!0,Model:!0,LensModel:!1,FocalLength:!0,FNumber:!0,ExposureTime:!0,ISO:!1,DateTimeOriginal:!1},showZoomControls:!1,showExifInfo:!0,toggleDarkMode:()=>n(e=>({darkMode:!e.darkMode})),toggleSyncZoom:()=>n(e=>({syncZoom:!e.syncZoom})),toggleSyncDraw:()=>n(e=>({syncDraw:!e.syncDraw})),togglePresentationMode:()=>n(e=>({presentationMode:!e.presentationMode})),toggleDemoMode:()=>n(e=>({demoMode:!e.demoMode})),toggleExifSetting:e=>n(t=>({exifSettings:{...t.exifSettings,[e]:!t.exifSettings[e]}})),toggleExifField:e=>n(t=>({visibleExifFields:t.visibleExifFields.includes(e)?t.visibleExifFields.filter(r=>r!==e):[...t.visibleExifFields,e]})),toggleAllExifSettings:e=>n(t=>{const r={...t.exifSettings};return Object.keys(r).forEach(i=>{r[i]=e}),{exifSettings:r}}),toggleShowZoomControls:()=>n(e=>({showZoomControls:!e.showZoomControls})),toggleShowExifInfo:()=>n(e=>({showExifInfo:!e.showExifInfo}))})),dt=hn((n,e)=>({images:[],lastImageUrl:null,hasViewedImages:!1,addImages:t=>n(r=>({images:[...r.images,...t],hasViewedImages:!0})),addImage:t=>n(r=>({images:[...r.images,t],hasViewedImages:!0})),removeImage:t=>n(r=>{var o;const i=r.images.filter(a=>a.id!==t);return i.length===0&&r.images.length>0?{images:i,lastImageUrl:((o=r.images.find(a=>a.id===t))==null?void 0:o.url)||null}:{images:i}}),clearImages:()=>n({images:[]}),resetState:()=>n({images:[],lastImageUrl:null,hasViewedImages:!1})}));var Ot=typeof self<"u"?self:global;const vt=typeof navigator<"u",bi=vt&&typeof HTMLImageElement>"u",Mt=!(typeof global>"u"||typeof process>"u"||!process.versions||!process.versions.node),Ut=Ot.Buffer,kt=Ot.BigInt,Bt=!!Ut,wi=n=>n;function Tt(n,e=wi){if(Mt)try{return typeof require=="function"?Promise.resolve(e(require(n))):import(n).then(e)}catch{console.warn(`Couldn't load ${n}`)}}let fn=Ot.fetch;const vi=n=>fn=n;if(!Ot.fetch){const n=Tt("http",r=>r),e=Tt("https",r=>r),t=(r,{headers:i}={})=>new Promise(async(o,a)=>{let{port:l,hostname:c,pathname:h,protocol:d,search:g}=new URL(r);const m={method:"GET",hostname:c,path:encodeURI(h)+g,headers:i};l!==""&&(m.port=Number(l));const S=(d==="https:"?await e:await n).request(m,j=>{if(j.statusCode===301||j.statusCode===302){let X=new URL(j.headers.location,r).toString();return t(X,{headers:i}).then(o).catch(a)}o({status:j.statusCode,arrayBuffer:()=>new Promise(X=>{let U=[];j.on("data",$=>U.push($)),j.on("end",()=>X(Buffer.concat(U)))})})});S.on("error",a),S.end()});vi(t)}function H(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}const Nt=n=>mr(n)?void 0:n,Si=n=>n!==void 0;function mr(n){return n===void 0||(n instanceof Map?n.size===0:Object.values(n).filter(Si).length===0)}function ge(n){let e=new Error(n);throw delete e.stack,e}function Qe(n){return(n=function(e){for(;e.endsWith("\0");)e=e.slice(0,-1);return e}(n).trim())===""?void 0:n}function tn(n){let e=function(t){let r=0;return t.ifd0.enabled&&(r+=1024),t.exif.enabled&&(r+=2048),t.makerNote&&(r+=2048),t.userComment&&(r+=1024),t.gps.enabled&&(r+=512),t.interop.enabled&&(r+=100),t.ifd1.enabled&&(r+=1024),r+2048}(n);return n.jfif.enabled&&(e+=50),n.xmp.enabled&&(e+=2e4),n.iptc.enabled&&(e+=14e3),n.icc.enabled&&(e+=6e3),e}const nn=n=>String.fromCharCode.apply(null,n),On=typeof TextDecoder<"u"?new TextDecoder("utf-8"):void 0;function xr(n){return On?On.decode(n):Bt?Buffer.from(n).toString("utf8"):decodeURIComponent(escape(nn(n)))}let qe=class at{static from(e,t){return e instanceof this&&e.le===t?e:new at(e,void 0,void 0,t)}constructor(e,t=0,r,i){if(typeof i=="boolean"&&(this.le=i),Array.isArray(e)&&(e=new Uint8Array(e)),e===0)this.byteOffset=0,this.byteLength=0;else if(e instanceof ArrayBuffer){r===void 0&&(r=e.byteLength-t);let o=new DataView(e,t,r);this._swapDataView(o)}else if(e instanceof Uint8Array||e instanceof DataView||e instanceof at){r===void 0&&(r=e.byteLength-t),(t+=e.byteOffset)+r>e.byteOffset+e.byteLength&&ge("Creating view outside of available memory in ArrayBuffer");let o=new DataView(e.buffer,t,r);this._swapDataView(o)}else if(typeof e=="number"){let o=new DataView(new ArrayBuffer(e));this._swapDataView(o)}else ge("Invalid input argument for BufferView: "+e)}_swapArrayBuffer(e){this._swapDataView(new DataView(e))}_swapBuffer(e){this._swapDataView(new DataView(e.buffer,e.byteOffset,e.byteLength))}_swapDataView(e){this.dataView=e,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength}_lengthToEnd(e){return this.byteLength-e}set(e,t,r=at){return e instanceof DataView||e instanceof at?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array||ge("BufferView.set(): Invalid data argument."),this.toUint8().set(e,t),new r(this,t,e.byteLength)}subarray(e,t){return t=t||this._lengthToEnd(e),new at(this,e,t)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(e,t){return new Uint8Array(this.buffer,this.byteOffset+e,t)}getString(e=0,t=this.byteLength){return xr(this.getUint8Array(e,t))}getLatin1String(e=0,t=this.byteLength){let r=this.getUint8Array(e,t);return nn(r)}getUnicodeString(e=0,t=this.byteLength){const r=[];for(let i=0;i<t&&e+i<this.byteLength;i+=2)r.push(this.getUint16(e+i));return nn(r)}getInt8(e){return this.dataView.getInt8(e)}getUint8(e){return this.dataView.getUint8(e)}getInt16(e,t=this.le){return this.dataView.getInt16(e,t)}getInt32(e,t=this.le){return this.dataView.getInt32(e,t)}getUint16(e,t=this.le){return this.dataView.getUint16(e,t)}getUint32(e,t=this.le){return this.dataView.getUint32(e,t)}getFloat32(e,t=this.le){return this.dataView.getFloat32(e,t)}getFloat64(e,t=this.le){return this.dataView.getFloat64(e,t)}getFloat(e,t=this.le){return this.dataView.getFloat32(e,t)}getDouble(e,t=this.le){return this.dataView.getFloat64(e,t)}getUintBytes(e,t,r){switch(t){case 1:return this.getUint8(e,r);case 2:return this.getUint16(e,r);case 4:return this.getUint32(e,r);case 8:return this.getUint64&&this.getUint64(e,r)}}getUint(e,t,r){switch(t){case 8:return this.getUint8(e,r);case 16:return this.getUint16(e,r);case 32:return this.getUint32(e,r);case 64:return this.getUint64&&this.getUint64(e,r)}}toString(e){return this.dataView.toString(e,this.constructor.name)}ensureChunk(){}};function rn(n,e){ge(`${n} '${e}' was not loaded, try using full build of exifr.`)}class gn extends Map{constructor(e){super(),this.kind=e}get(e,t){return this.has(e)||rn(this.kind,e),t&&(e in t||function(r,i){ge(`Unknown ${r} '${i}'.`)}(this.kind,e),t[e].enabled||rn(this.kind,e)),super.get(e)}keyList(){return Array.from(this.keys())}}var De=new gn("file parser"),fe=new gn("segment parser"),Re=new gn("file reader");function ki(n,e){return typeof n=="string"?Un(n,e):vt&&!bi&&n instanceof HTMLImageElement?Un(n.src,e):n instanceof Uint8Array||n instanceof ArrayBuffer||n instanceof DataView?new qe(n):vt&&n instanceof Blob?sn(n,e,"blob",rt):void ge("Invalid input argument")}function Un(n,e){return(t=n).startsWith("data:")||t.length>1e4?on(n,e,"base64"):Mt&&n.includes("://")?sn(n,e,"url",nt):Mt?on(n,e,"fs"):vt?sn(n,e,"url",nt):void ge("Invalid input argument");var t}async function sn(n,e,t,r){return Re.has(t)?on(n,e,t):r?async function(i,o){let a=await o(i);return new qe(a)}(n,r):void ge(`Parser ${t} is not loaded`)}async function on(n,e,t){let r=new(Re.get(t))(n,e);return await r.read(),r}const nt=n=>fn(n).then(e=>e.arrayBuffer()),rt=n=>new Promise((e,t)=>{let r=new FileReader;r.onloadend=()=>e(r.result||new ArrayBuffer),r.onerror=t,r.readAsArrayBuffer(n)});let Ci=class extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}};function he(n,e,t){let r=new Ci;for(let[i,o]of t)r.set(i,o);if(Array.isArray(e))for(let i of e)n.set(i,r);else n.set(e,r);return r}function it(n,e,t){let r,i=n.get(e);for(r of t)i.set(r[0],r[1])}const we=new Map,Fe=new Map,Ke=new Map,Ge=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],ut=["jfif","xmp","icc","iptc","ihdr"],st=["tiff",...ut],ue=["ifd0","ifd1","exif","gps","interop"],_e=[...st,...ue],Xe=["makerNote","userComment"],ht=["translateKeys","translateValues","reviveValues","multiSegment"],Ye=[...ht,"sanitize","mergeOutput","silentErrors"];class yr{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}let gt=class extends yr{get needed(){return this.enabled||this.deps.size>0}constructor(e,t,r,i){if(super(),H(this,"enabled",!1),H(this,"skip",new Set),H(this,"pick",new Set),H(this,"deps",new Set),H(this,"translateKeys",!1),H(this,"translateValues",!1),H(this,"reviveValues",!1),this.key=e,this.enabled=t,this.parse=this.enabled,this.applyInheritables(i),this.canBeFiltered=ue.includes(e),this.canBeFiltered&&(this.dict=we.get(e)),r!==void 0)if(Array.isArray(r))this.parse=this.enabled=!0,this.canBeFiltered&&r.length>0&&this.translateTagSet(r,this.pick);else if(typeof r=="object"){if(this.enabled=!0,this.parse=r.parse!==!1,this.canBeFiltered){let{pick:o,skip:a}=r;o&&o.length>0&&this.translateTagSet(o,this.pick),a&&a.length>0&&this.translateTagSet(a,this.skip)}this.applyInheritables(r)}else r===!0||r===!1?this.parse=this.enabled=r:ge(`Invalid options argument: ${r}`)}applyInheritables(e){let t,r;for(t of ht)r=e[t],r!==void 0&&(this[t]=r)}translateTagSet(e,t){if(this.dict){let r,i,{tagKeys:o,tagValues:a}=this.dict;for(r of e)typeof r=="string"?(i=a.indexOf(r),i===-1&&(i=o.indexOf(Number(r))),i!==-1&&t.add(Number(o[i]))):t.add(r)}else for(let r of e)t.add(r)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,Ft(this.pick,this.deps)):this.enabled&&this.pick.size>0&&Ft(this.pick,this.deps)}};var Me={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},Bn=new Map;let ot=class extends yr{static useCached(e){let t=Bn.get(e);return t!==void 0||(t=new this(e),Bn.set(e,t)),t}constructor(e){super(),e===!0?this.setupFromTrue():e===void 0?this.setupFromUndefined():Array.isArray(e)?this.setupFromArray(e):typeof e=="object"?this.setupFromObject(e):ge(`Invalid options argument ${e}`),this.firstChunkSize===void 0&&(this.firstChunkSize=vt?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let e;for(e of Ge)this[e]=Me[e];for(e of Ye)this[e]=Me[e];for(e of Xe)this[e]=Me[e];for(e of _e)this[e]=new gt(e,Me[e],void 0,this)}setupFromTrue(){let e;for(e of Ge)this[e]=Me[e];for(e of Ye)this[e]=Me[e];for(e of Xe)this[e]=!0;for(e of _e)this[e]=new gt(e,!0,void 0,this)}setupFromArray(e){let t;for(t of Ge)this[t]=Me[t];for(t of Ye)this[t]=Me[t];for(t of Xe)this[t]=Me[t];for(t of _e)this[t]=new gt(t,!1,void 0,this);this.setupGlobalFilters(e,void 0,ue)}setupFromObject(e){let t;for(t of(ue.ifd0=ue.ifd0||ue.image,ue.ifd1=ue.ifd1||ue.thumbnail,Object.assign(this,e),Ge))this[t]=Xt(e[t],Me[t]);for(t of Ye)this[t]=Xt(e[t],Me[t]);for(t of Xe)this[t]=Xt(e[t],Me[t]);for(t of st)this[t]=new gt(t,Me[t],e[t],this);for(t of ue)this[t]=new gt(t,Me[t],e[t],this.tiff);this.setupGlobalFilters(e.pick,e.skip,ue,_e),e.tiff===!0?this.batchEnableWithBool(ue,!0):e.tiff===!1?this.batchEnableWithUserValue(ue,e):Array.isArray(e.tiff)?this.setupGlobalFilters(e.tiff,void 0,ue):typeof e.tiff=="object"&&this.setupGlobalFilters(e.tiff.pick,e.tiff.skip,ue)}batchEnableWithBool(e,t){for(let r of e)this[r].enabled=t}batchEnableWithUserValue(e,t){for(let r of e){let i=t[r];this[r].enabled=i!==!1&&i!==void 0}}setupGlobalFilters(e,t,r,i=r){if(e&&e.length){for(let a of i)this[a].enabled=!1;let o=$n(e,r);for(let[a,l]of o)Ft(this[a].pick,l),this[a].enabled=!0}else if(t&&t.length){let o=$n(t,r);for(let[a,l]of o)Ft(this[a].skip,l)}}filterNestedSegmentTags(){let{ifd0:e,exif:t,xmp:r,iptc:i,icc:o}=this;this.makerNote?t.deps.add(37500):t.skip.add(37500),this.userComment?t.deps.add(37510):t.skip.add(37510),r.enabled||e.skip.add(700),i.enabled||e.skip.add(33723),o.enabled||e.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:e,exif:t,gps:r,interop:i}=this;i.needed&&(t.deps.add(40965),e.deps.add(40965)),t.needed&&e.deps.add(34665),r.needed&&e.deps.add(34853),this.tiff.enabled=ue.some(o=>this[o].enabled===!0)||this.makerNote||this.userComment;for(let o of ue)this[o].finalizeFilters()}get onlyTiff(){return!ut.map(e=>this[e].enabled).some(e=>e===!0)&&this.tiff.enabled}checkLoadedPlugins(){for(let e of st)this[e].enabled&&!fe.has(e)&&rn("segment parser",e)}};function $n(n,e){let t,r,i,o,a=[];for(i of e){for(o of(t=we.get(i),r=[],t))(n.includes(o[0])||n.includes(o[1]))&&r.push(o[0]);r.length&&a.push([i,r])}return a}function Xt(n,e){return n!==void 0?n:e!==void 0?e:void 0}function Ft(n,e){for(let t of e)n.add(t)}H(ot,"default",Me);class Ze{constructor(e){H(this,"parsers",{}),H(this,"output",{}),H(this,"errors",[]),H(this,"pushToErrors",t=>this.errors.push(t)),this.options=ot.useCached(e)}async read(e){this.file=await ki(e,this.options)}setup(){if(this.fileParser)return;let{file:e}=this,t=e.getUint16(0);for(let[r,i]of De)if(i.canHandle(e,t))return this.fileParser=new i(this.options,this.file,this.parsers),e[r]=!0;this.file.close&&this.file.close(),ge("Unknown file format")}async parse(){let{output:e,errors:t}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),t.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&t.length>0&&(e.errors=t),Nt(e)}async executeParsers(){let{output:e}=this;await this.fileParser.parse();let t=Object.values(this.parsers).map(async r=>{let i=await r.parse();r.assignToOutput(e,i)});this.options.silentErrors&&(t=t.map(r=>r.catch(this.pushToErrors))),await Promise.all(t)}async extractThumbnail(){this.setup();let{options:e,file:t}=this,r=fe.get("tiff",e);var i;if(t.tiff?i={start:0,type:"tiff"}:t.jpeg&&(i=await this.fileParser.getOrFindSegment("tiff")),i===void 0)return;let o=await this.fileParser.ensureSegmentChunk(i),a=this.parsers.tiff=new r(o,e,t),l=await a.extractThumbnail();return t.close&&t.close(),l}}async function $t(n,e){let t=new Ze(e);return await t.read(n),t.parse()}var ji=Object.freeze({__proto__:null,parse:$t,Exifr:Ze,fileParsers:De,segmentParsers:fe,fileReaders:Re,tagKeys:we,tagValues:Fe,tagRevivers:Ke,createDictionary:he,extendDictionary:it,fetchUrlAsArrayBuffer:nt,readBlobAsArrayBuffer:rt,chunkedProps:Ge,otherSegments:ut,segments:st,tiffBlocks:ue,segmentsAndBlocks:_e,tiffExtractables:Xe,inheritables:ht,allFormatters:Ye,Options:ot});class Wt{constructor(e,t,r){H(this,"errors",[]),H(this,"ensureSegmentChunk",async i=>{let o=i.start,a=i.size||65536;if(this.file.chunked)if(this.file.available(o,a))i.chunk=this.file.subarray(o,a);else try{i.chunk=await this.file.readChunk(o,a)}catch(l){ge(`Couldn't read segment: ${JSON.stringify(i)}. ${l.message}`)}else this.file.byteLength>o+a?i.chunk=this.file.subarray(o,a):i.size===void 0?i.chunk=this.file.subarray(o):ge("Segment unreachable: "+JSON.stringify(i));return i.chunk}),this.extendOptions&&this.extendOptions(e),this.options=e,this.file=t,this.parsers=r}injectSegment(e,t){this.options[e].enabled&&this.createParser(e,t)}createParser(e,t){let r=new(fe.get(e))(t,this.options,this.file);return this.parsers[e]=r}createParsers(e){for(let t of e){let{type:r,chunk:i}=t,o=this.options[r];if(o&&o.enabled){let a=this.parsers[r];a&&a.append||a||this.createParser(r,i)}}}async readSegments(e){let t=e.map(this.ensureSegmentChunk);await Promise.all(t)}}class Ne{static findPosition(e,t){let r=e.getUint16(t+2)+2,i=typeof this.headerLength=="function"?this.headerLength(e,t,r):this.headerLength,o=t+i,a=r-i;return{offset:t,length:r,headerLength:i,start:o,size:a,end:o+a}}static parse(e,t={}){return new this(e,new ot({[this.type]:t}),e).parse()}normalizeInput(e){return e instanceof qe?e:new qe(e)}constructor(e,t={},r){H(this,"errors",[]),H(this,"raw",new Map),H(this,"handleError",i=>{if(!this.options.silentErrors)throw i;this.errors.push(i.message)}),this.chunk=this.normalizeInput(e),this.file=r,this.type=this.constructor.type,this.globalOptions=this.options=t,this.localOptions=t[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(e,t){let r=Ke.get(t),i=Fe.get(t),o=we.get(t),a=this.options[t],l=a.reviveValues&&!!r,c=a.translateValues&&!!i,h=a.translateKeys&&!!o,d={};for(let[g,m]of e)l&&r.has(g)?m=r.get(g)(m):c&&i.has(g)&&(m=this.translateValue(m,i.get(g))),h&&o.has(g)&&(g=o.get(g)||g),d[g]=m;return d}translateValue(e,t){return t[e]||t.DEFAULT||e}assignToOutput(e,t){this.assignObjectToOutput(e,this.constructor.type,t)}assignObjectToOutput(e,t,r){if(this.globalOptions.mergeOutput)return Object.assign(e,r);e[t]?Object.assign(e[t],r):e[t]=r}}H(Ne,"headerLength",4),H(Ne,"type",void 0),H(Ne,"multiSegment",!1),H(Ne,"canHandle",()=>!1);function Pi(n){return n===192||n===194||n===196||n===219||n===221||n===218||n===254}function Ii(n){return n>=224&&n<=239}function Ei(n,e,t){for(let[r,i]of fe)if(i.canHandle(n,e,t))return r}class Wn extends Wt{constructor(...e){super(...e),H(this,"appSegments",[]),H(this,"jpegSegments",[]),H(this,"unknownSegments",[])}static canHandle(e,t){return t===65496}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(e){e===!0?(this.findAll=!0,this.wanted=new Set(fe.keyList())):(e=e===void 0?fe.keyList().filter(t=>this.options[t].enabled):e.filter(t=>this.options[t].enabled&&fe.has(t)),this.findAll=!1,this.remaining=new Set(e),this.wanted=new Set(e)),this.unfinishedMultiSegment=!1}async findAppSegments(e=0,t){this.setupSegmentFinderArgs(t);let{file:r,findAll:i,wanted:o,remaining:a}=this;if(!i&&this.file.chunked&&(i=Array.from(o).some(l=>{let c=fe.get(l),h=this.options[l];return c.multiSegment&&h.multiSegment}),i&&await this.file.readWhole()),e=this.findAppSegmentsInRange(e,r.byteLength),!this.options.onlyTiff&&r.chunked){let l=!1;for(;a.size>0&&!l&&(r.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:c}=r,h=this.appSegments.some(d=>!this.file.available(d.offset||d.start,d.length||d.size));if(l=e>c&&!h?!await r.readNextChunk(e):!await r.readNextChunk(c),(e=this.findAppSegmentsInRange(e,r.byteLength))===void 0)return}}}findAppSegmentsInRange(e,t){t-=2;let r,i,o,a,l,c,{file:h,findAll:d,wanted:g,remaining:m,options:S}=this;for(;e<t;e++)if(h.getUint8(e)===255){if(r=h.getUint8(e+1),Ii(r)){if(i=h.getUint16(e+2),o=Ei(h,e,i),o&&g.has(o)&&(a=fe.get(o),l=a.findPosition(h,e),c=S[o],l.type=o,this.appSegments.push(l),!d&&(a.multiSegment&&c.multiSegment?(this.unfinishedMultiSegment=l.chunkNumber<l.chunkCount,this.unfinishedMultiSegment||m.delete(o)):m.delete(o),m.size===0)))break;S.recordUnknownSegments&&(l=Ne.findPosition(h,e),l.marker=r,this.unknownSegments.push(l)),e+=i+1}else if(Pi(r)){if(i=h.getUint16(e+2),r===218&&S.stopAfterSos!==!1)return;S.recordJpegSegments&&this.jpegSegments.push({offset:e,length:i,marker:r}),e+=i+1}}return e}mergeMultiSegments(){if(!this.appSegments.some(t=>t.multiSegment))return;let e=function(t,r){let i,o,a,l=new Map;for(let c=0;c<t.length;c++)i=t[c],o=i[r],l.has(o)?a=l.get(o):l.set(o,a=[]),a.push(i);return Array.from(l)}(this.appSegments,"type");this.mergedAppSegments=e.map(([t,r])=>{let i=fe.get(t,this.options);return i.handleMultiSegments?{type:t,chunk:i.handleMultiSegments(r)}:r[0]})}getSegment(e){return this.appSegments.find(t=>t.type===e)}async getOrFindSegment(e){let t=this.getSegment(e);return t===void 0&&(await this.findAppSegments(0,[e]),t=this.getSegment(e)),t}}H(Wn,"type","jpeg"),De.set("jpeg",Wn);const Ai=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class Mi extends Ne{parseHeader(){var e=this.chunk.getUint16();e===18761?this.le=!0:e===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(e,t,r=new Map){let{pick:i,skip:o}=this.options[t];i=new Set(i);let a=i.size>0,l=o.size===0,c=this.chunk.getUint16(e);e+=2;for(let h=0;h<c;h++){let d=this.chunk.getUint16(e);if(a){if(i.has(d)&&(r.set(d,this.parseTag(e,d,t)),i.delete(d),i.size===0))break}else!l&&o.has(d)||r.set(d,this.parseTag(e,d,t));e+=12}return r}parseTag(e,t,r){let{chunk:i}=this,o=i.getUint16(e+2),a=i.getUint32(e+4),l=Ai[o];if(l*a<=4?e+=8:e=i.getUint32(e+8),(o<1||o>13)&&ge(`Invalid TIFF value type. block: ${r.toUpperCase()}, tag: ${t.toString(16)}, type: ${o}, offset ${e}`),e>i.byteLength&&ge(`Invalid TIFF value offset. block: ${r.toUpperCase()}, tag: ${t.toString(16)}, type: ${o}, offset ${e} is outside of chunk size ${i.byteLength}`),o===1)return i.getUint8Array(e,a);if(o===2)return Qe(i.getString(e,a));if(o===7)return i.getUint8Array(e,a);if(a===1)return this.parseTagValue(o,e);{let c=new(function(d){switch(d){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(o))(a),h=l;for(let d=0;d<a;d++)c[d]=this.parseTagValue(o,e),e+=h;return c}}parseTagValue(e,t){let{chunk:r}=this;switch(e){case 1:return r.getUint8(t);case 3:return r.getUint16(t);case 4:return r.getUint32(t);case 5:return r.getUint32(t)/r.getUint32(t+4);case 6:return r.getInt8(t);case 8:return r.getInt16(t);case 9:return r.getInt32(t);case 10:return r.getInt32(t)/r.getInt32(t+4);case 11:return r.getFloat(t);case 12:return r.getDouble(t);case 13:return r.getUint32(t);default:ge(`Invalid tiff type ${e}`)}}}class Yt extends Mi{static canHandle(e,t){return e.getUint8(t+1)===225&&e.getUint32(t+4)===1165519206&&e.getUint16(t+8)===0}async parse(){this.parseHeader();let{options:e}=this;return e.ifd0.enabled&&await this.parseIfd0Block(),e.exif.enabled&&await this.safeParse("parseExifBlock"),e.gps.enabled&&await this.safeParse("parseGpsBlock"),e.interop.enabled&&await this.safeParse("parseInteropBlock"),e.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(e){let t=this[e]();return t.catch!==void 0&&(t=t.catch(this.handleError)),t}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let e=this.chunk.getUint16(this.ifd0Offset),t=this.ifd0Offset+2+12*e;this.ifd1Offset=this.chunk.getUint32(t)}}parseBlock(e,t){let r=new Map;return this[t]=r,this.parseTags(e,t,r),r}async parseIfd0Block(){if(this.ifd0)return;let{file:e}=this;this.findIfd0Offset(),this.ifd0Offset<8&&ge("Malformed EXIF data"),!e.chunked&&this.ifd0Offset>e.byteLength&&ge(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${e.byteLength}`),e.tiff&&await e.ensureChunk(this.ifd0Offset,tn(this.options));let t=this.parseBlock(this.ifd0Offset,"ifd0");return t.size!==0?(this.exifOffset=t.get(34665),this.interopOffset=t.get(40965),this.gpsOffset=t.get(34853),this.xmp=t.get(700),this.iptc=t.get(33723),this.icc=t.get(34675),this.options.sanitize&&(t.delete(34665),t.delete(40965),t.delete(34853),t.delete(700),t.delete(33723),t.delete(34675)),t):void 0}async parseExifBlock(){if(this.exif||(this.ifd0||await this.parseIfd0Block(),this.exifOffset===void 0))return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,tn(this.options));let e=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=e.get(40965)),this.makerNote=e.get(37500),this.userComment=e.get(37510),this.options.sanitize&&(e.delete(40965),e.delete(37500),e.delete(37510)),this.unpack(e,41728),this.unpack(e,41729),e}unpack(e,t){let r=e.get(t);r&&r.length===1&&e.set(t,r[0])}async parseGpsBlock(){if(this.gps||(this.ifd0||await this.parseIfd0Block(),this.gpsOffset===void 0))return;let e=this.parseBlock(this.gpsOffset,"gps");return e&&e.has(2)&&e.has(4)&&(e.set("latitude",Hn(...e.get(2),e.get(1))),e.set("longitude",Hn(...e.get(4),e.get(3)))),e}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),this.interopOffset!==void 0||this.exif||await this.parseExifBlock(),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(e=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||e))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),this.ifd1===void 0)return;let e=this.ifd1.get(513),t=this.ifd1.get(514);return this.chunk.getUint8Array(e,t)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let e,t,r,i={};for(t of ue)if(e=this[t],!mr(e))if(r=this.canTranslate?this.translateBlock(e,t):Object.fromEntries(e),this.options.mergeOutput){if(t==="ifd1")continue;Object.assign(i,r)}else i[t]=r;return this.makerNote&&(i.makerNote=this.makerNote),this.userComment&&(i.userComment=this.userComment),i}assignToOutput(e,t){if(this.globalOptions.mergeOutput)Object.assign(e,t);else for(let[r,i]of Object.entries(t))this.assignObjectToOutput(e,r,i)}}function Hn(n,e,t,r){var i=n+e/60+t/3600;return r!=="S"&&r!=="W"||(i*=-1),i}H(Yt,"type","tiff"),H(Yt,"headerLength",10),fe.set("tiff",Yt);var Ti=Object.freeze({__proto__:null,default:ji,Exifr:Ze,fileParsers:De,segmentParsers:fe,fileReaders:Re,tagKeys:we,tagValues:Fe,tagRevivers:Ke,createDictionary:he,extendDictionary:it,fetchUrlAsArrayBuffer:nt,readBlobAsArrayBuffer:rt,chunkedProps:Ge,otherSegments:ut,segments:st,tiffBlocks:ue,segmentsAndBlocks:_e,tiffExtractables:Xe,inheritables:ht,allFormatters:Ye,Options:ot,parse:$t});const pn={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},mn=Object.assign({},pn,{firstChunkSize:4e4,gps:[1,2,3,4]});async function br(n){let e=new Ze(mn);await e.read(n);let t=await e.parse();if(t&&t.gps){let{latitude:r,longitude:i}=t.gps;return{latitude:r,longitude:i}}}const xn=Object.assign({},pn,{tiff:!1,ifd1:!0,mergeOutput:!1});async function wr(n){let e=new Ze(xn);await e.read(n);let t=await e.extractThumbnail();return t&&Bt?Ut.from(t):t}async function vr(n){let e=await this.thumbnail(n);if(e!==void 0){let t=new Blob([e]);return URL.createObjectURL(t)}}const yn=Object.assign({},pn,{firstChunkSize:4e4,ifd0:[274]});async function bn(n){let e=new Ze(yn);await e.read(n);let t=await e.parse();if(t&&t.ifd0)return t.ifd0[274]}const wn=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let et=!0,tt=!0;if(typeof navigator=="object"){let n=navigator.userAgent;if(n.includes("iPad")||n.includes("iPhone")){let e=n.match(/OS (\d+)_(\d+)/);if(e){let[,t,r]=e;et=Number(t)+.1*Number(r)<13.4,tt=!1}}else if(n.includes("OS X 10")){let[,e]=n.match(/OS X 10[_.](\d+)/);et=tt=Number(e)<15}if(n.includes("Chrome/")){let[,e]=n.match(/Chrome\/(\d+)/);et=tt=Number(e)<81}else if(n.includes("Firefox/")){let[,e]=n.match(/Firefox\/(\d+)/);et=tt=Number(e)<77}}async function Sr(n){let e=await bn(n);return Object.assign({canvas:et,css:tt},wn[e])}class Ni extends qe{constructor(...e){super(...e),H(this,"ranges",new Fi),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(e,t,r){if(e===0&&this.byteLength===0&&r){let i=new DataView(r.buffer||r,r.byteOffset,r.byteLength);this._swapDataView(i)}else{let i=e+t;if(i>this.byteLength){let{dataView:o}=this._extend(i);this._swapDataView(o)}}}_extend(e){let t;t=Bt?Ut.allocUnsafe(e):new Uint8Array(e);let r=new DataView(t.buffer,t.byteOffset,t.byteLength);return t.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:t,dataView:r}}subarray(e,t,r=!1){return t=t||this._lengthToEnd(e),r&&this._tryExtend(e,t),this.ranges.add(e,t),super.subarray(e,t)}set(e,t,r=!1){r&&this._tryExtend(t,e.byteLength,e);let i=super.set(e,t);return this.ranges.add(t,i.byteLength),i}async ensureChunk(e,t){this.chunked&&(this.ranges.available(e,t)||await this.readChunk(e,t))}available(e,t){return this.ranges.available(e,t)}}class Fi{constructor(){H(this,"list",[])}get length(){return this.list.length}add(e,t,r=0){let i=e+t,o=this.list.filter(a=>zn(e,a.offset,i)||zn(e,a.end,i));if(o.length>0){e=Math.min(e,...o.map(l=>l.offset)),i=Math.max(i,...o.map(l=>l.end)),t=i-e;let a=o.shift();a.offset=e,a.length=t,a.end=i,this.list=this.list.filter(l=>!o.includes(l))}else this.list.push({offset:e,length:t,end:i})}available(e,t){let r=e+t;return this.list.some(i=>i.offset<=e&&r<=i.end)}}function zn(n,e,t){return n<=e&&e<=t}class Ht extends Ni{constructor(e,t){super(0),H(this,"chunksRead",0),this.input=e,this.options=t}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(e=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let t=this.options.chunkSize,r=await this.readChunk(e,t);return!!r&&r.byteLength===t}async readChunk(e,t){if(this.chunksRead++,(t=this.safeWrapAddress(e,t))!==0)return this._readChunk(e,t)}safeWrapAddress(e,t){return this.size!==void 0&&e+t>this.size?Math.max(0,this.size-e):t}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}Re.set("blob",class extends Ht{async readWhole(){this.chunked=!1;let n=await rt(this.input);this._swapArrayBuffer(n)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(n,e){let t=e?n+e:void 0,r=this.input.slice(n,t),i=await rt(r);return this.set(i,n,!0)}});var Di=Object.freeze({__proto__:null,default:Ti,Exifr:Ze,fileParsers:De,segmentParsers:fe,fileReaders:Re,tagKeys:we,tagValues:Fe,tagRevivers:Ke,createDictionary:he,extendDictionary:it,fetchUrlAsArrayBuffer:nt,readBlobAsArrayBuffer:rt,chunkedProps:Ge,otherSegments:ut,segments:st,tiffBlocks:ue,segmentsAndBlocks:_e,tiffExtractables:Xe,inheritables:ht,allFormatters:Ye,Options:ot,parse:$t,gpsOnlyOptions:mn,gps:br,thumbnailOnlyOptions:xn,thumbnail:wr,thumbnailUrl:vr,orientationOnlyOptions:yn,orientation:bn,rotations:wn,get rotateCanvas(){return et},get rotateCss(){return tt},rotation:Sr});Re.set("url",class extends Ht{async readWhole(){this.chunked=!1;let n=await nt(this.input);n instanceof ArrayBuffer?this._swapArrayBuffer(n):n instanceof Uint8Array&&this._swapBuffer(n)}async _readChunk(n,e){let t=e?n+e-1:void 0,r=this.options.httpHeaders||{};(n||t)&&(r.range=`bytes=${[n,t].join("-")}`);let i=await fn(this.input,{headers:r}),o=await i.arrayBuffer(),a=o.byteLength;if(i.status!==416)return a!==e&&(this.size=n+a),this.set(o,n,!0)}});qe.prototype.getUint64=function(n){let e=this.getUint32(n),t=this.getUint32(n+4);return e<1048575?e<<32|t:typeof kt!==void 0?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),kt(e)<<kt(32)|kt(t)):void ge("Trying to read 64b value but JS can only handle 53b numbers.")};class Li extends Wt{parseBoxes(e=0){let t=[];for(;e<this.file.byteLength-4;){let r=this.parseBoxHead(e);if(t.push(r),r.length===0)break;e+=r.length}return t}parseSubBoxes(e){e.boxes=this.parseBoxes(e.start)}findBox(e,t){return e.boxes===void 0&&this.parseSubBoxes(e),e.boxes.find(r=>r.kind===t)}parseBoxHead(e){let t=this.file.getUint32(e),r=this.file.getString(e+4,4),i=e+8;return t===1&&(t=this.file.getUint64(e+8),i+=8),{offset:e,length:t,kind:r,start:i}}parseBoxFullHead(e){if(e.version!==void 0)return;let t=this.file.getUint32(e.start);e.version=t>>24,e.start+=4}}class kr extends Li{static canHandle(e,t){if(t!==0)return!1;let r=e.getUint16(2);if(r>50)return!1;let i=16,o=[];for(;i<r;)o.push(e.getString(i,4)),i+=4;return o.includes(this.type)}async parse(){let e=this.file.getUint32(0),t=this.parseBoxHead(e);for(;t.kind!=="meta";)e+=t.length,await this.file.ensureChunk(e,16),t=this.parseBoxHead(e);await this.file.ensureChunk(t.offset,t.length),this.parseBoxFullHead(t),this.parseSubBoxes(t),this.options.icc.enabled&&await this.findIcc(t),this.options.tiff.enabled&&await this.findExif(t)}async registerSegment(e,t,r){await this.file.ensureChunk(t,r);let i=this.file.subarray(t,r);this.createParser(e,i)}async findIcc(e){let t=this.findBox(e,"iprp");if(t===void 0)return;let r=this.findBox(t,"ipco");if(r===void 0)return;let i=this.findBox(r,"colr");i!==void 0&&await this.registerSegment("icc",i.offset+12,i.length)}async findExif(e){let t=this.findBox(e,"iinf");if(t===void 0)return;let r=this.findBox(e,"iloc");if(r===void 0)return;let i=this.findExifLocIdInIinf(t),o=this.findExtentInIloc(r,i);if(o===void 0)return;let[a,l]=o;await this.file.ensureChunk(a,l);let c=4+this.file.getUint32(a);a+=c,l-=c,await this.registerSegment("tiff",a,l)}findExifLocIdInIinf(e){this.parseBoxFullHead(e);let t,r,i,o,a=e.start,l=this.file.getUint16(a);for(a+=2;l--;){if(t=this.parseBoxHead(a),this.parseBoxFullHead(t),r=t.start,t.version>=2&&(i=t.version===3?4:2,o=this.file.getString(r+i+2,4),o==="Exif"))return this.file.getUintBytes(r,i);a+=t.length}}get8bits(e){let t=this.file.getUint8(e);return[t>>4,15&t]}findExtentInIloc(e,t){this.parseBoxFullHead(e);let r=e.start,[i,o]=this.get8bits(r++),[a,l]=this.get8bits(r++),c=e.version===2?4:2,h=e.version===1||e.version===2?2:0,d=l+i+o,g=e.version===2?4:2,m=this.file.getUintBytes(r,g);for(r+=g;m--;){let S=this.file.getUintBytes(r,c);r+=c+h+2+a;let j=this.file.getUint16(r);if(r+=2,S===t)return j>1&&console.warn(`ILOC box has more than one extent but we're only processing one
Please create an issue at https://github.com/MikeKovarik/exifr with this file`),[this.file.getUintBytes(r+l,i),this.file.getUintBytes(r+l+i,o)];r+=j*d}}}class Cr extends kr{}H(Cr,"type","heic");class Vn extends kr{}H(Vn,"type","avif"),De.set("heic",Cr),De.set("avif",Vn),he(we,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),he(we,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),he(we,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),he(Fe,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let bt=he(Fe,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const Gn={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};bt.set(37392,Gn),bt.set(41488,Gn);const Kt={0:"Normal",1:"Low",2:"High"};function _n(n){return typeof n=="object"&&n.length!==void 0?n[0]:n}function Xn(n){let e=Array.from(n).slice(1);return e[1]>15&&(e=e.map(t=>String.fromCharCode(t))),e[2]!=="0"&&e[2]!==0||e.pop(),e.join(".")}function Jt(n){if(typeof n=="string"){var[e,t,r,i,o,a]=n.trim().split(/[-: ]/g).map(Number),l=new Date(e,t-1,r);return Number.isNaN(i)||Number.isNaN(o)||Number.isNaN(a)||(l.setHours(i),l.setMinutes(o),l.setSeconds(a)),Number.isNaN(+l)?n:l}}function pt(n){if(typeof n=="string")return n;let e=[];if(n[1]===0&&n[n.length-1]===0)for(let t=0;t<n.length;t+=2)e.push(Yn(n[t+1],n[t]));else for(let t=0;t<n.length;t+=2)e.push(Yn(n[t],n[t+1]));return Qe(String.fromCodePoint(...e))}function Yn(n,e){return n<<8|e}bt.set(41992,Kt),bt.set(41993,Kt),bt.set(41994,Kt),he(Ke,["ifd0","ifd1"],[[50827,function(n){return typeof n!="string"?xr(n):n}],[306,Jt],[40091,pt],[40092,pt],[40093,pt],[40094,pt],[40095,pt]]),he(Ke,"exif",[[40960,Xn],[36864,Xn],[36867,Jt],[36868,Jt],[40962,_n],[40963,_n]]),he(Ke,"gps",[[0,n=>Array.from(n).join(".")],[7,n=>Array.from(n).join(":")]]);class qt extends Ne{static canHandle(e,t){return e.getUint8(t+1)===225&&e.getUint32(t+4)===1752462448&&e.getString(t+4,20)==="http://ns.adobe.com/"}static headerLength(e,t){return e.getString(t+4,34)==="http://ns.adobe.com/xmp/extension/"?79:33}static findPosition(e,t){let r=super.findPosition(e,t);return r.multiSegment=r.extended=r.headerLength===79,r.multiSegment?(r.chunkCount=e.getUint8(t+72),r.chunkNumber=e.getUint8(t+76),e.getUint8(t+77)!==0&&r.chunkNumber++):(r.chunkCount=1/0,r.chunkNumber=-1),r}static handleMultiSegments(e){return e.map(t=>t.chunk.getString()).join("")}normalizeInput(e){return typeof e=="string"?e:qe.from(e).getString()}parse(e=this.chunk){if(!this.localOptions.parse)return e;e=function(o){let a={},l={};for(let c of Er)a[c]=[],l[c]=0;return o.replace(Bi,(c,h,d)=>{if(h==="<"){let g=++l[d];return a[d].push(g),`${c}#${g}`}return`${c}#${a[d].pop()}`})}(e);let t=lt.findAll(e,"rdf","Description");t.length===0&&t.push(new lt("rdf","Description",void 0,e));let r,i={};for(let o of t)for(let a of o.properties)r=Ui(a.ns,i),jr(a,r);return function(o){let a;for(let l in o)a=o[l]=Nt(o[l]),a===void 0&&delete o[l];return Nt(o)}(i)}assignToOutput(e,t){if(this.localOptions.parse)for(let[r,i]of Object.entries(t))switch(r){case"tiff":this.assignObjectToOutput(e,"ifd0",i);break;case"exif":this.assignObjectToOutput(e,"exif",i);break;case"xmlns":break;default:this.assignObjectToOutput(e,r,i)}else e.xmp=t}}H(qt,"type","xmp"),H(qt,"multiSegment",!0),fe.set("xmp",qt);class Dt{static findAll(e){return Pr(e,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(Dt.unpackMatch)}static unpackMatch(e){let t=e[1],r=e[2],i=e[3].slice(1,-1);return i=Ir(i),new Dt(t,r,i)}constructor(e,t,r){this.ns=e,this.name=t,this.value=r}serialize(){return this.value}}class lt{static findAll(e,t,r){if(t!==void 0||r!==void 0){t=t||"[\\w\\d-]+",r=r||"[\\w\\d-]+";var i=new RegExp(`<(${t}):(${r})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else i=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return Pr(e,i).map(lt.unpackMatch)}static unpackMatch(e){let t=e[1],r=e[2],i=e[4],o=e[8];return new lt(t,r,i,o)}constructor(e,t,r,i){this.ns=e,this.name=t,this.attrString=r,this.innerXml=i,this.attrs=Dt.findAll(r),this.children=lt.findAll(i),this.value=this.children.length===0?Ir(i):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return this.value!==void 0&&this.attrs.length===0&&this.children.length===0}get isListContainer(){return this.children.length===1&&this.children[0].isList}get isList(){let{ns:e,name:t}=this;return e==="rdf"&&(t==="Seq"||t==="Bag"||t==="Alt")}get isListItem(){return this.ns==="rdf"&&this.name==="li"}serialize(){if(this.properties.length===0&&this.value===void 0)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return Oi(this.children.map(Ri));if(this.isListItem&&this.children.length===1&&this.attrs.length===0)return this.children[0].serialize();let e={};for(let t of this.properties)jr(t,e);return this.value!==void 0&&(e.value=this.value),Nt(e)}}function jr(n,e){let t=n.serialize();t!==void 0&&(e[n.name]=t)}var Ri=n=>n.serialize(),Oi=n=>n.length===1?n[0]:n,Ui=(n,e)=>e[n]?e[n]:e[n]={};function Pr(n,e){let t,r=[];if(!n)return r;for(;(t=e.exec(n))!==null;)r.push(t);return r}function Ir(n){if(function(r){return r==null||r==="null"||r==="undefined"||r===""||r.trim()===""}(n))return;let e=Number(n);if(!Number.isNaN(e))return e;let t=n.toLowerCase();return t==="true"||t!=="false"&&n.trim()}const Er=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],Bi=new RegExp(`(<|\\/)(${Er.join("|")})`,"g");var $i=Object.freeze({__proto__:null,default:Di,Exifr:Ze,fileParsers:De,segmentParsers:fe,fileReaders:Re,tagKeys:we,tagValues:Fe,tagRevivers:Ke,createDictionary:he,extendDictionary:it,fetchUrlAsArrayBuffer:nt,readBlobAsArrayBuffer:rt,chunkedProps:Ge,otherSegments:ut,segments:st,tiffBlocks:ue,segmentsAndBlocks:_e,tiffExtractables:Xe,inheritables:ht,allFormatters:Ye,Options:ot,parse:$t,gpsOnlyOptions:mn,gps:br,thumbnailOnlyOptions:xn,thumbnail:wr,thumbnailUrl:vr,orientationOnlyOptions:yn,orientation:bn,rotations:wn,get rotateCanvas(){return et},get rotateCss(){return tt},rotation:Sr});let Kn=Tt("fs",n=>n.promises);Re.set("fs",class extends Ht{async readWhole(){this.chunked=!1,this.fs=await Kn;let n=await this.fs.readFile(this.input);this._swapBuffer(n)}async readChunked(){this.chunked=!0,this.fs=await Kn,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){this.fh===void 0&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(n,e){this.fh===void 0&&await this.open(),n+e>this.size&&(e=this.size-n);var t=this.subarray(n,e,!0);return await this.fh.read(t.dataView,0,e,n),t}async close(){if(this.fh){let n=this.fh;this.fh=void 0,await n.close()}}});Re.set("base64",class extends Ht{constructor(...n){super(...n),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(n,e){let t,r,i=this.input;n===void 0?(n=0,t=0,r=0):(t=4*Math.floor(n/3),r=n-t/4*3),e===void 0&&(e=this.size);let o=n+e,a=t+4*Math.ceil(o/3);i=i.slice(t,a);let l=Math.min(e,this.size-n);if(Bt){let c=Ut.from(i,"base64").slice(r,r+l);return this.set(c,n,!0)}{let c=this.subarray(n,l,!0),h=atob(i),d=c.toUint8();for(let g=0;g<l;g++)d[g]=h.charCodeAt(r+g);return c}}});class Jn extends Wt{static canHandle(e,t){return t===18761||t===19789}extendOptions(e){let{ifd0:t,xmp:r,iptc:i,icc:o}=e;r.enabled&&t.deps.add(700),i.enabled&&t.deps.add(33723),o.enabled&&t.deps.add(34675),t.finalizeFilters()}async parse(){let{tiff:e,xmp:t,iptc:r,icc:i}=this.options;if(e.enabled||t.enabled||r.enabled||i.enabled){let o=Math.max(tn(this.options),this.options.chunkSize);await this.file.ensureChunk(0,o),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(e){if(this.parsers.tiff[e]){let t=this.parsers.tiff[e];this.injectSegment(e,t)}}}H(Jn,"type","tiff"),De.set("tiff",Jn);let Wi=Tt("zlib");const Hi=["ihdr","iccp","text","itxt","exif"];class qn extends Wt{constructor(...e){super(...e),H(this,"catchError",t=>this.errors.push(t)),H(this,"metaChunks",[]),H(this,"unknownChunks",[])}static canHandle(e,t){return t===35152&&e.getUint32(0)===2303741511&&e.getUint32(4)===218765834}async parse(){let{file:e}=this;await this.findPngChunksInRange(8,e.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(e,t){let{file:r}=this;for(;e<t;){let i=r.getUint32(e),o=r.getUint32(e+4),a=r.getString(e+4,4).toLowerCase(),l=i+4+4+4,c={type:a,offset:e,length:l,start:e+4+4,size:i,marker:o};Hi.includes(a)?this.metaChunks.push(c):this.unknownChunks.push(c),e+=l}}parseTextChunks(){let e=this.metaChunks.filter(t=>t.type==="text");for(let t of e){let[r,i]=this.file.getString(t.start,t.size).split("\0");this.injectKeyValToIhdr(r,i)}}injectKeyValToIhdr(e,t){let r=this.parsers.ihdr;r&&r.raw.set(e,t)}findIhdr(){let e=this.metaChunks.find(t=>t.type==="ihdr");e&&this.options.ihdr.enabled!==!1&&this.createParser("ihdr",e.chunk)}async findExif(){let e=this.metaChunks.find(t=>t.type==="exif");e&&this.injectSegment("tiff",e.chunk)}async findXmp(){let e=this.metaChunks.filter(t=>t.type==="itxt");for(let t of e)t.chunk.getString(0,17)==="XML:com.adobe.xmp"&&this.injectSegment("xmp",t.chunk)}async findIcc(){let e=this.metaChunks.find(l=>l.type==="iccp");if(!e)return;let{chunk:t}=e,r=t.getUint8Array(0,81),i=0;for(;i<80&&r[i]!==0;)i++;let o=i+2,a=t.getString(0,i);if(this.injectKeyValToIhdr("ProfileName",a),Mt){let l=await Wi,c=t.getUint8Array(o);c=l.inflateSync(c),this.injectSegment("icc",c)}}}H(qn,"type","png"),De.set("png",qn),he(we,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),it(we,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let Zn=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];it(we,"ifd0",Zn),it(we,"exif",Zn),he(Fe,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class Zt extends Ne{static canHandle(e,t){return e.getUint8(t+1)===224&&e.getUint32(t+4)===1246120262&&e.getUint8(t+8)===0}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}H(Zt,"type","jfif"),H(Zt,"headerLength",9),fe.set("jfif",Zt),he(we,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class Qn extends Ne{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}H(Qn,"type","ihdr"),fe.set("ihdr",Qn),he(we,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),he(Fe,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class At extends Ne{static canHandle(e,t){return e.getUint8(t+1)===226&&e.getUint32(t+4)===1229144927}static findPosition(e,t){let r=super.findPosition(e,t);return r.chunkNumber=e.getUint8(t+16),r.chunkCount=e.getUint8(t+17),r.multiSegment=r.chunkCount>1,r}static handleMultiSegments(e){return function(t){let r=function(i){let o=i[0].constructor,a=0;for(let h of i)a+=h.length;let l=new o(a),c=0;for(let h of i)l.set(h,c),c+=h.length;return l}(t.map(i=>i.chunk.toUint8()));return new qe(r)}(e)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:e}=this;this.chunk.byteLength<84&&ge("ICC header is too short");for(let[t,r]of Object.entries(zi)){t=parseInt(t,10);let i=r(this.chunk,t);i!=="\0\0\0\0"&&e.set(t,i)}}parseTags(){let e,t,r,i,o,{raw:a}=this,l=this.chunk.getUint32(128),c=132,h=this.chunk.byteLength;for(;l--;){if(e=this.chunk.getString(c,4),t=this.chunk.getUint32(c+4),r=this.chunk.getUint32(c+8),i=this.chunk.getString(t,4),t+r>h)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");o=this.parseTag(i,t,r),o!==void 0&&o!=="\0\0\0\0"&&a.set(e,o),c+=12}}parseTag(e,t,r){switch(e){case"desc":return this.parseDesc(t);case"mluc":return this.parseMluc(t);case"text":return this.parseText(t,r);case"sig ":return this.parseSig(t)}if(!(t+r>this.chunk.byteLength))return this.chunk.getUint8Array(t,r)}parseDesc(e){let t=this.chunk.getUint32(e+8)-1;return Qe(this.chunk.getString(e+12,t))}parseText(e,t){return Qe(this.chunk.getString(e+8,t-8))}parseSig(e){return Qe(this.chunk.getString(e+8,4))}parseMluc(e){let{chunk:t}=this,r=t.getUint32(e+8),i=t.getUint32(e+12),o=e+16,a=[];for(let l=0;l<r;l++){let c=t.getString(o+0,2),h=t.getString(o+2,2),d=t.getUint32(o+4),g=t.getUint32(o+8)+e,m=Qe(t.getUnicodeString(g,d));a.push({lang:c,country:h,text:m}),o+=i}return r===1?a[0].text:a}translateValue(e,t){return typeof e=="string"?t[e]||t[e.toLowerCase()]||e:t[e]||e}}H(At,"type","icc"),H(At,"multiSegment",!0),H(At,"headerLength",18);const zi={4:Ue,8:function(n,e){return[n.getUint8(e),n.getUint8(e+1)>>4,n.getUint8(e+1)%16].map(t=>t.toString(10)).join(".")},12:Ue,16:Ue,20:Ue,24:function(n,e){const t=n.getUint16(e),r=n.getUint16(e+2)-1,i=n.getUint16(e+4),o=n.getUint16(e+6),a=n.getUint16(e+8),l=n.getUint16(e+10);return new Date(Date.UTC(t,r,i,o,a,l))},36:Ue,40:Ue,48:Ue,52:Ue,64:(n,e)=>n.getUint32(e),80:Ue};function Ue(n,e){return Qe(n.getString(e,4))}fe.set("icc",At),he(we,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const Ct={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},er={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};he(Fe,"icc",[[4,Ct],[12,er],[40,Object.assign({},Ct,er)],[48,Ct],[80,Ct],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class jt extends Ne{static canHandle(e,t,r){return e.getUint8(t+1)===237&&e.getString(t+4,9)==="Photoshop"&&this.containsIptc8bim(e,t,r)!==void 0}static headerLength(e,t,r){let i,o=this.containsIptc8bim(e,t,r);if(o!==void 0)return i=e.getUint8(t+o+7),i%2!=0&&(i+=1),i===0&&(i=4),o+8+i}static containsIptc8bim(e,t,r){for(let i=0;i<r;i++)if(this.isIptcSegmentHead(e,t+i))return i}static isIptcSegmentHead(e,t){return e.getUint8(t)===56&&e.getUint32(t)===943868237&&e.getUint16(t+4)===1028}parse(){let{raw:e}=this,t=this.chunk.byteLength-1,r=!1;for(let i=0;i<t;i++)if(this.chunk.getUint8(i)===28&&this.chunk.getUint8(i+1)===2){r=!0;let o=this.chunk.getUint16(i+3),a=this.chunk.getUint8(i+2),l=this.chunk.getLatin1String(i+5,o);e.set(a,this.pluralizeValue(e.get(a),l)),i+=4+o}else if(r)break;return this.translate(),this.output}pluralizeValue(e,t){return e!==void 0?e instanceof Array?(e.push(t),e):[e,t]:t}}H(jt,"type","iptc"),H(jt,"translateValues",!1),H(jt,"reviveValues",!1),fe.set("iptc",jt),he(we,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),he(Fe,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);const Vi=async n=>{try{return await $r(n)}catch(e){console.warn("HEIC:",e);const t=n.name.toLowerCase();return t.endsWith(".heic")||t.endsWith(".heif")}},Gi=async(n,e=.85,t)=>{typeof t=="function"&&t(10);try{console.log("HEIC:",n.name);const r=await lr({blob:n,type:"image/jpeg",quality:e});return typeof t=="function"&&t(100),console.log("HEIC:",n.name),r instanceof Blob?r:new Blob([r],{type:"image/jpeg"})}catch(r){console.error("HEICJPEG:",r),typeof t=="function"&&t(50);try{return console.log("HEIC:",n.name),await new Promise((i,o)=>{const a=new FileReader;a.onload=l=>{const c=new Image;c.onload=()=>{const h=document.createElement("canvas");h.width=c.width,h.height=c.height;const d=h.getContext("2d");if(!d){o(new Error("Canvas"));return}d.drawImage(c,0,0),typeof t=="function"&&t(90),h.toBlob(g=>{g?(typeof t=="function"&&t(100),i(g)):o(new Error("Canvas"))},"image/jpeg",e)},c.onerror=()=>{o(new Error(""))},c.src=URL.createObjectURL(n)},a.onerror=()=>{o(new Error(""))},a.readAsArrayBuffer(n)})}catch(i){console.error(":",i);const o=document.createElement("canvas");o.width=800,o.height=600;const a=o.getContext("2d");if(!a)throw new Error("Canvas");return a.fillStyle="#f0f0f0",a.fillRect(0,0,o.width,o.height),a.fillStyle="#333333",a.font="bold 20px Arial",a.textAlign="center",a.fillText("HEIC",o.width/2,o.height/2-20),a.fillText(n.name,o.width/2,o.height/2+20),a.font="16px Arial",a.fillText("JPEG",o.width/2,o.height/2+60),new Promise((l,c)=>{o.toBlob(h=>{h?(typeof t=="function"&&t(100),l(h)):c(new Error(""))},"image/jpeg",.8)})}}},_i=async(n,e)=>{typeof e=="function"&&e(10);try{console.log("HEICPNG:",n.name);const t=await lr({blob:n,type:"image/png",quality:1});return typeof e=="function"&&e(100),console.log("HEICPNG:",n.name),t instanceof Blob?t:new Blob([t],{type:"image/png"})}catch(t){console.error("HEICPNG:",t),typeof e=="function"&&e(50);try{return console.log("HEICPNG:",n.name),await new Promise((r,i)=>{const o=new FileReader;o.onload=a=>{const l=new Image;l.onload=()=>{const c=document.createElement("canvas");c.width=l.width,c.height=l.height;const h=c.getContext("2d");if(!h){i(new Error("Canvas"));return}h.drawImage(l,0,0),typeof e=="function"&&e(90),c.toBlob(d=>{d?(typeof e=="function"&&e(100),r(d)):i(new Error("Canvas"))},"image/png")},l.onerror=()=>{i(new Error(""))},l.src=URL.createObjectURL(n)},o.onerror=()=>{i(new Error(""))},o.readAsArrayBuffer(n)})}catch(r){throw console.error(":",r),new Error("HEICJPEG")}}},Xi=async(n,e="image/jpeg",t=.85,r)=>{try{return e==="image/png"?_i(n,r):Gi(n,t,r)}catch(i){console.error("HEIC:",i),typeof r=="function"&&r(30),console.log("HEIC:",n.name);try{return await new Promise((o,a)=>{const l=new FileReader;l.onload=c=>{var d;const h=new Image;h.onload=()=>{const g=document.createElement("canvas");g.width=h.width||800,g.height=h.height||600;const m=g.getContext("2d");if(!m){a(new Error("Canvas"));return}h.width===0||h.height===0?(g.width=800,g.height=600,m.fillStyle="#f0f0f0",m.fillRect(0,0,g.width,g.height),m.fillStyle="#333333",m.font="bold 20px Arial",m.textAlign="center",m.fillText("HEIC",g.width/2,g.height/2-20),m.fillText(n.name,g.width/2,g.height/2+20),m.font="16px Arial",m.fillText("JPEG",g.width/2,g.height/2+60)):m.drawImage(h,0,0),typeof r=="function"&&r(90),g.toBlob(S=>{S?(typeof r=="function"&&r(100),o(S),URL.revokeObjectURL(h.src)):a(new Error("Canvas"))},e,e==="image/jpeg"?t:void 0)},h.onerror=()=>{const g=document.createElement("canvas");g.width=800,g.height=600;const m=g.getContext("2d");if(!m){a(new Error("Canvas"));return}m.fillStyle="#f0f0f0",m.fillRect(0,0,g.width,g.height),m.fillStyle="#333333",m.font="bold 20px Arial",m.textAlign="center",m.fillText("HEIC",g.width/2,g.height/2-20),m.fillText(n.name,g.width/2,g.height/2+20),m.font="16px Arial",m.fillText("JPEG",g.width/2,g.height/2+60),g.toBlob(S=>{S?(typeof r=="function"&&r(100),o(S)):a(new Error("Canvas"))},"image/jpeg",.8),URL.revokeObjectURL(h.src)},h.src=URL.createObjectURL(new Blob([(d=c.target)==null?void 0:d.result],{type:"image/heic"}))},l.onerror=()=>{a(new Error(""))},l.readAsArrayBuffer(n)})}catch(o){console.error(":",o);const a=document.createElement("canvas");a.width=800,a.height=600;const l=a.getContext("2d");if(!l)throw new Error("Canvas");return l.fillStyle="#f0f0f0",l.fillRect(0,0,a.width,a.height),l.fillStyle="#333333",l.font="bold 20px Arial",l.textAlign="center",l.fillText("HEIC",a.width/2,a.height/2-20),l.fillText(n.name,a.width/2,a.height/2+20),l.font="16px Arial",l.fillText("JPEG",a.width/2,a.height/2+60),new Promise((c,h)=>{a.toBlob(d=>{d?(typeof r=="function"&&r(100),c(d)):h(new Error(""))},"image/jpeg",.8)})}}},Yi=async n=>{try{const e=new DataView(n),t=160,r=120,i=!0,o=i?4:3,a=t*r*o,l=new Uint8Array(a);for(let c=0;c<r;c++)for(let h=0;h<t;h++){const d=(c*t+h)*o,g=Math.floor(255*(h/t)),m=Math.floor(255*(c/r)),S=Math.floor(128+127*Math.sin(h*c/1e3));l[d]=g,l[d+1]=m,l[d+2]=S,i&&(l[d+3]=255)}return{width:t,height:r,data:l,isPlaceholder:!0,format:i?"rgba":"rgb"}}catch(e){throw console.error("RAW:",e),new Error("RAW")}},Ki=async n=>{try{const e=new DataView(n),t=new Uint8Array(n.slice(0,16));let r="Unknown",i="Unknown";const o=Array.from(t).map(a=>String.fromCharCode(a)).join("");return o.includes("FUJI")?r="Fujifilm":o.includes("SONY")?r="Sony":o.includes("NIKON")&&(r="Nikon"),{make:r,model:i,lens:"Unknown",focalLength:"0",aperture:"0",exposureTime:"0",iso:"0",timestamp:new Date().toISOString(),width:0,height:0,isPlaceholder:!0}}catch(e){return console.error("RAW:",e),{make:"Unknown",model:"Unknown",lens:"Unknown",focalLength:"0",aperture:"0",exposureTime:"0",iso:"0",timestamp:new Date().toISOString(),width:0,height:0,isPlaceholder:!0}}},Ji=[".arw",".cr2",".cr3",".nef",".raf",".rw2",".orf",".pef",".srw",".dng"],Ve=new Map,xt=new Map,qi=n=>{const e=n.toLowerCase();return Ji.some(t=>e.endsWith(t))},Qt=async n=>{const e=document.createElement("canvas");e.width=800,e.height=600;const t=e.getContext("2d");if(!t)throw new Error("Canvas");t.fillStyle="#f0f0f0",t.fillRect(0,0,e.width,e.height),t.fillStyle="#e8e8e8";for(let r=0;r<e.width;r+=20)for(let i=0;i<e.height;i+=20)(r+i)%40===0&&t.fillRect(r,i,20,20);return t.save(),t.translate(e.width/2,e.height/2-80),t.scale(.6,.6),t.fillStyle="#333",t.fillRect(-75,-30,150,80),t.fillStyle="#222",t.fillRect(-60,-40,120,20),t.beginPath(),t.arc(0,10,40,0,Math.PI*2),t.fillStyle="#222",t.fill(),t.beginPath(),t.arc(0,10,30,0,Math.PI*2),t.fillStyle="#444",t.fill(),t.beginPath(),t.arc(0,10,20,0,Math.PI*2),t.fillStyle="#666",t.fill(),t.fillStyle="#888",t.fillRect(30,-35,20,10),t.restore(),t.fillStyle="#333333",t.font="bold 22px Arial",t.textAlign="center",t.fillText("RAW",e.width/2,e.height/2+20),t.font="18px Arial",t.fillText(n.name,e.width/2,e.height/2+50),t.font="16px Arial",t.fillText("",e.width/2,e.height/2+80),new Promise((r,i)=>{e.toBlob(o=>{o?r(URL.createObjectURL(o)):i(new Error(""))},"image/jpeg",.85)})},Zi=async n=>{const e=`${n.name}-${n.size}-${n.lastModified}`;if(Ve.has(e))return Ve.get(e);try{const t=await n.arrayBuffer();try{const r=await Yi(t);if(r&&r.data){const i=document.createElement("canvas");i.width=r.width,i.height=r.height;const o=i.getContext("2d");if(!o)throw new Error("Canvas");const a=r.data,l=r.width,c=r.height;try{if(a.length===l*c*3){const d=new Uint8ClampedArray(l*c*4);for(let m=0;m<l*c;m++){const S=m*3,j=m*4;d[j]=a[S],d[j+1]=a[S+1],d[j+2]=a[S+2],d[j+3]=255}const g=new ImageData(d,l,c);o.putImageData(g,0,0)}else{const d=new ImageData(new Uint8ClampedArray(a.buffer),l,c);o.putImageData(d,0,0)}}catch(d){console.warn("ImageData:",d);const g=o.createImageData(l,c),m=g.data;if(a.length===l*c*3)for(let S=0;S<l*c;S++)m[S*4]=a[S*3],m[S*4+1]=a[S*3+1],m[S*4+2]=a[S*3+2],m[S*4+3]=255;else for(let S=0;S<l*c;S++){const j=S%255;m[S*4]=j,m[S*4+1]=j,m[S*4+2]=j,m[S*4+3]=255}o.putImageData(g,0,0)}const h=await new Promise((d,g)=>{i.toBlob(m=>{m?d(URL.createObjectURL(m)):g(new Error(""))},"image/jpeg")});return Ve.set(e,h),h}else if(r&&r.isPlaceholder){const i=await Qt(n);return Ve.set(e,i),i}throw new Error("")}catch(r){console.warn("dcraw:",r);const i=await Qt(n);return Ve.set(e,i),i}}catch(t){console.error("RAW:",t);const r=await Qt(n);return Ve.set(e,r),r}},Qi=async n=>{const e=`${n.name}-${n.size}-${n.lastModified}`;if(xt.has(e))return xt.get(e);try{const t=await n.arrayBuffer(),r=await Ki(t),i={fileName:n.name,fileSize:n.size,fileType:"RAW",fileModified:new Date(n.lastModified).toISOString(),make:r.make||"Unknown",model:r.model||"Unknown",lens:r.lens||"Unknown",focalLength:r.focalLength||"Unknown",aperture:r.aperture||"Unknown",shutterSpeed:r.exposureTime||"Unknown",iso:r.iso||"Unknown",dateTaken:r.timestamp||new Date().toISOString(),width:r.width||0,height:r.height||0,fromRaw:!0,isPlaceholder:r.isPlaceholder||!1};return xt.set(e,i),i}catch(t){console.error("RAW:",t);const r={fileName:n.name,fileSize:n.size,fileType:"RAW ()",fileModified:new Date(n.lastModified).toISOString(),make:"Unknown",model:"Unknown",lens:"Unknown",focalLength:"Unknown",aperture:"Unknown",shutterSpeed:"Unknown",iso:"Unknown",dateTaken:new Date().toISOString(),width:0,height:0,fromRaw:!0,isPlaceholder:!0};return xt.set(e,r),r}},es=async n=>{const[e,t]=await Promise.all([Zi(n),Qi(n)]);return{preview:e,metadata:t}},ts=()=>{Ve.forEach(n=>{try{URL.revokeObjectURL(n)}catch(e){console.warn("URL:",e)}}),Ve.clear(),xt.clear()},an=async n=>{var e;try{const t=URL.createObjectURL(n),r=await new Promise(o=>{const a=new Image;a.onload=()=>{o({width:a.naturalWidth,height:a.naturalHeight})},a.onerror=()=>{o({width:0,height:0})},a.src=t,setTimeout(()=>o({width:0,height:0}),3e3)});let i={};try{i=await $i.parse(n,{pick:["Make","Model","LensModel","FocalLength","FNumber","ExposureTime","ISO","DateTimeOriginal"]})||{}}catch(o){console.warn("EXIF:",o)}return{id:`${Date.now()}-${Math.random().toString(36).substring(2)}-${n.name}`,file:n,url:t,name:n.name,exif:{FileName:n.name,Resolution:`${r.width}  ${r.height}`,Make:(i==null?void 0:i.Make)||"Unknown",Model:(i==null?void 0:i.Model)||"Unknown",LensModel:(i==null?void 0:i.LensModel)||"Unknown",FocalLength:(i==null?void 0:i.FocalLength)||0,FNumber:(i==null?void 0:i.FNumber)||0,ExposureTime:((e=i==null?void 0:i.ExposureTime)==null?void 0:e.toString())||"0",ISO:(i==null?void 0:i.ISO)||0,DateTimeOriginal:(i==null?void 0:i.DateTimeOriginal)||"Unknown"}}}catch(t){return console.error(":",t),{id:`error-${Date.now()}-${n.name}`,file:n,url:"",name:n.name,exif:{FileName:n.name,Resolution:"0  0",Make:"Error",Model:"Error",LensModel:"Error",FocalLength:0,FNumber:0,ExposureTime:"0",ISO:0,DateTimeOriginal:new Date().toISOString()}}}},ns=({isOpen:n,files:e,onClose:t,onConfirm:r,onCancel:i,isConverting:o})=>{const{darkMode:a}=Le();if(!n)return null;const l=d=>{switch(d){case"heif":return"HEIF/HEIC";case"raw":return"RAW";default:return""}},c=d=>{switch(d){case"pending":return{label:"",color:a?"text-gray-400":"text-gray-500"};case"converting":return{label:"",color:"text-sky-500"};case"success":return{label:"",color:"text-green-500"};case"error":return{label:"",color:"text-red-500"};default:return{label:"",color:"text-gray-500"}}},h=()=>{if(!o)return"";const d=e.length,g=e.filter(S=>S.status==="success"||S.status==="error").length,m=e.filter(S=>S.status==="error").length;return g<d?` (${g}/${d})`:m>0?`${m} `:""};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:s.jsx("div",{className:`w-full max-w-lg rounded-xl shadow-2xl 
          ${a?"bg-gray-900 text-gray-100":"bg-white text-gray-800"}`,children:s.jsxs("div",{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:""}),s.jsx("p",{className:"text-sm mb-4",children:" EXIF"}),s.jsx("div",{className:`mt-4 mb-6 rounded-lg overflow-hidden border 
            ${a?"border-gray-700 bg-gray-800":"border-gray-200 bg-gray-50"}`,children:s.jsx("div",{className:"max-h-64 overflow-y-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:`text-xs ${a?"bg-gray-800":"bg-gray-100"}`,children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-2 text-left",children:""}),s.jsx("th",{className:"px-4 py-2 text-left",children:""}),s.jsx("th",{className:"px-4 py-2 text-right",children:""})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:e.map((d,g)=>{const m=c(d.status);return s.jsxs("tr",{className:a?"hover:bg-gray-700":"hover:bg-gray-50",children:[s.jsx("td",{className:"px-4 py-3 text-sm truncate max-w-[180px]",children:d.file.name}),s.jsx("td",{className:"px-4 py-3 text-sm",children:l(d.type)}),s.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:[s.jsx("span",{className:m.color,children:m.label}),d.status==="converting"&&d.progress!==void 0&&s.jsx("div",{className:"w-full mt-1 bg-gray-200 dark:bg-gray-700 rounded-full h-1.5",children:s.jsx("div",{className:"bg-sky-500 h-1.5 rounded-full",style:{width:`${d.progress}%`}})}),d.status==="error"&&d.error&&s.jsx("div",{className:"text-xs text-red-500 mt-1",children:d.error})]})]},g)})})]})})}),o&&s.jsxs("div",{className:"mb-6",children:[s.jsx("p",{className:"text-sm font-medium mb-2",children:h()}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:"bg-sky-500 h-2 rounded-full transition-all duration-300",style:{width:`${e.filter(d=>d.status==="success"||d.status==="error").length/e.length*100}%`}})})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[!o&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:i,className:`px-4 py-2 rounded text-sm font-medium
                    ${a?"bg-gray-800 text-gray-300 hover:bg-gray-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:""}),s.jsx("button",{onClick:r,className:"px-4 py-2 bg-sky-500 text-white rounded text-sm font-medium hover:bg-sky-600",children:""})]}),o&&s.jsx("button",{onClick:t,disabled:e.some(d=>d.status==="converting"),className:`px-4 py-2 rounded text-sm font-medium
                  ${e.some(d=>d.status==="converting")?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-sky-500 text-white hover:bg-sky-600"}`,children:e.every(d=>d.status==="success"||d.status==="error")?"":""})]})]})})})},Ar=async(n,e="")=>{try{console.log(":",n.name,":",e);const t=document.createElement("canvas");t.width=800,t.height=600;const r=t.getContext("2d");if(!r)throw new Error("Canvas");const i=n.name.toLowerCase(),o=i.endsWith(".heic")||i.endsWith(".heif"),a=[".arw",".cr2",".cr3",".nef",".raf",".rw2",".orf",".pef",".srw",".dng"].some(c=>i.endsWith(c));let l;o?(l=r.createLinearGradient(0,0,t.width,t.height),l.addColorStop(0,"#e8f4f8"),l.addColorStop(1,"#d0e8f0")):a?(l=r.createLinearGradient(0,0,t.width,t.height),l.addColorStop(0,"#f8f4e8"),l.addColorStop(1,"#f0e8d0")):(l=r.createLinearGradient(0,0,t.width,t.height),l.addColorStop(0,"#f5f5f5"),l.addColorStop(1,"#e0e0e0")),r.fillStyle=l,r.fillRect(0,0,t.width,t.height),r.fillStyle="rgba(200, 200, 200, 0.3)";for(let c=0;c<t.width;c+=20)for(let h=0;h<t.height;h+=20)(c+h)%40===0&&r.fillRect(c,h,20,20);return r.save(),r.translate(t.width/2,t.height/2-100),o?(r.fillStyle="#2980b9",r.fillRect(-50,-40,100,80),r.fillStyle="#fff",r.fillRect(-46,-36,92,72),r.fillStyle="#3498db",r.beginPath(),r.arc(-15,-5,15,0,Math.PI*2),r.fill(),r.fillStyle="#2ecc71",r.fillRect(5,-15,35,50)):a?(r.fillStyle="#e67e22",r.fillRect(-50,-30,100,60),r.fillStyle="#d35400",r.fillRect(-40,-40,80,20),r.beginPath(),r.arc(0,0,25,0,Math.PI*2),r.fillStyle="#34495e",r.fill(),r.beginPath(),r.arc(0,0,18,0,Math.PI*2),r.fillStyle="#2c3e50",r.fill()):(r.fillStyle="#95a5a6",r.fillRect(-45,-35,90,70),r.fillStyle="#fff",r.fillRect(-40,-30,80,60),r.fillStyle="#bdc3c7",r.beginPath(),r.arc(-15,-5,10,0,Math.PI*2),r.fill(),r.fillStyle="#95a5a6",r.fillRect(5,-10,30,40)),r.restore(),r.fillStyle="#333333",r.font="bold 20px Arial",r.textAlign="center",r.fillText(e,t.width/2,t.height/2+30),r.font="16px Arial",r.fillText(n.name,t.width/2,t.height/2+60),new Promise((c,h)=>{t.toBlob(d=>{d?c(d):h(new Error(""))},"image/jpeg",.85)})}catch(t){console.error(":",t);const r=document.createElement("canvas");r.width=100,r.height=100;const i=r.getContext("2d");return i&&(i.fillStyle="#f0f0f0",i.fillRect(0,0,100,100),i.fillStyle="#999",i.font="12px Arial",i.textAlign="center",i.fillText("",50,50)),new Promise(o=>{r.toBlob(a=>{if(a)o(a);else{const l=new Blob([""],{type:"text/plain"});o(l)}},"image/jpeg",.5)})}},rs=async(n,e)=>{try{e&&e(10);const t=await Xi(n,"image/jpeg",.8,e);return e&&e(100),{success:!0,blob:t}}catch(t){console.error("HEIF:",t);try{const r=await Ar(n,"HEIF/HEIC");return e&&e(100),{success:!0,blob:r}}catch{return e&&e(100),{success:!1,error:t instanceof Error?t:new Error("")}}}},is=async(n,e)=>{try{e&&e(10);const t=await es(n);if(e&&e(100),t.preview)return{success:!0,url:t.preview};throw new Error("RAW")}catch(t){console.error("RAW:",t);try{const r=await Ar(n,"RAW");return e&&e(100),{success:!0,blob:r}}catch{return e&&e(100),{success:!1,error:t instanceof Error?t:new Error("")}}}},ss=async n=>{try{if(await Vi(n))return{needsConversion:!0,type:"heif"}}catch(e){console.warn("HEIF:",e);const t=n.name.toLowerCase();if(t.endsWith(".heic")||t.endsWith(".heif"))return{needsConversion:!0,type:"heif"}}return qi(n.name)?{needsConversion:!0,type:"raw"}:{needsConversion:!1}},os=()=>{const{darkMode:n,demoMode:e}=Le(),{addImages:t,clearImages:r,removeImage:i,images:o,addImage:a}=dt(),[l,c]=b.useState(!1),[h,d]=b.useState(!1),[g,m]=b.useState([]),[S,j]=b.useState([]),[X,U]=b.useState(!1),[$,R]=b.useState(!0);b.useEffect(()=>()=>{ts()},[]);const p=b.useCallback(async(x,k=!0)=>{if(x.length){k&&o.length>0&&r(),c(!0);try{const N=await Promise.all(x.map(an));t(N)}catch(N){console.error(":",N),alert("")}finally{c(!1)}}},[t,r,o.length]),le=b.useCallback(async(x,k=!0)=>{if(!x.length)return;const N=[],O=[];for(const Z of Array.from(x))if(Z.type.startsWith("image/"))O.push(Z);else try{const{needsConversion:z,type:ie}=await ss(Z);z&&ie?N.push({file:Z,type:ie,status:"pending"}):Z.name.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp|bmp)$/)&&O.push(Z)}catch(z){console.warn(`: ${Z.name}`,z),Z.name.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp|bmp)$/)&&O.push(Z)}N.length>0?(m(N),j(O),R(k),d(!0)):O.length>0&&p(O,k)},[p]),ke=b.useCallback(async()=>{if(g.length===0)return;U(!0);const x=[],k=(O,Z)=>{m(z=>z.map((ie,pe)=>pe===O?{...ie,...Z}:ie))};for(let O=0;O<g.length;O++){const Z=g[O];try{if(k(O,{status:"converting",progress:0}),Z.type==="heif"){const z=await rs(Z.file,ie=>{k(O,{progress:ie})});if(z.success&&z.blob){const ie=new File([z.blob],Z.file.name.replace(/\.(heic|heif)$/i,".jpg"),{type:"image/jpeg"});x.push(ie),k(O,{status:"success"})}else k(O,{status:"error",error:z.error?z.error.message:""})}else if(Z.type==="raw"){const z=await is(Z.file,ie=>{k(O,{progress:ie})});if(z.success){if(z.blob){const ie=new File([z.blob],Z.file.name.replace(/\.(arw|cr2|cr3|nef|raf|rw2|orf|pef|srw|dng)$/i,".jpg"),{type:"image/jpeg"});x.push(ie)}else x.push(Z.file);k(O,{status:"success"})}else k(O,{status:"error",error:z.error?z.error.message:"RAW"})}}catch(z){console.error(":",z),k(O,{status:"error",error:z instanceof Error?z.message:""})}}const N=[...x,...S];N.length>0&&await p(N,$)},[g,S,$,p]),ce=b.useCallback(()=>{S.length>0&&p(S,$),d(!1),m([]),j([])},[S,$,p]),C=b.useCallback(()=>{d(!1),m([]),j([]),U(!1)},[]),I=b.useCallback(x=>{x.preventDefault();const k=x.dataTransfer.files;k&&k.length>0&&le(k)},[le]),D=b.useCallback(x=>{x.preventDefault()},[]),A=b.useCallback(()=>{const x=document.createElement("input");x.type="file",x.accept="image/*,.heic,.heif,.arw,.cr2,.cr3,.nef,.raf,.rw2,.orf,.pef,.srw,.dng",x.multiple=!0,x.onchange=k=>{k.target instanceof HTMLInputElement&&k.target.files&&le(k.target.files)},x.click()},[le]),Y=()=>s.jsxs("div",{className:"w-full",children:[!e&&s.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[s.jsx("button",{onClick:()=>{const x=document.createElement("input");x.type="file",x.accept="image/*,.heic,.heif,.arw,.cr2,.cr3,.nef,.raf,.rw2,.orf,.pef,.srw,.dng",x.multiple=!0,x.onchange=k=>{k.target instanceof HTMLInputElement&&k.target.files&&(r(),le(k.target.files,!0))},x.click()},className:`px-4 py-2 rounded-lg font-medium transition-all duration-200
              ${n?"bg-sky-500/20 text-gray-100 hover:bg-sky-500/30":"bg-sky-500/10 text-gray-700 hover:bg-sky-500/20"}`,children:""}),s.jsx("button",{onClick:()=>{const x=document.createElement("input");x.type="file",x.accept="image/*,.heic,.heif,.arw,.cr2,.cr3,.nef,.raf,.rw2,.orf,.pef,.srw,.dng",x.onchange=k=>{k.target instanceof HTMLInputElement&&k.target.files&&le(k.target.files,!1)},x.click()},className:`p-2 rounded-lg font-medium transition-all duration-200
              ${n?"bg-sky-500/20 text-gray-100 hover:bg-sky-500/30":"bg-sky-500/10 text-gray-700 hover:bg-sky-500/20"}`,title:"",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),s.jsx("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 ${e?"p-0":""}`,children:o.map(x=>s.jsxs("div",{className:`relative group aspect-[3/2] ${n?"bg-black":"bg-gray-100"} rounded-lg overflow-hidden`,children:[s.jsx("img",{src:x.url,alt:x.name,className:"w-full h-full object-contain"}),!e&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),s.jsx("button",{onClick:()=>i(x.id),className:`absolute top-2 right-2 p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200
                    ${n?"bg-gray-900/80 text-gray-100 hover:bg-gray-900":"bg-white/80 text-gray-700 hover:bg-white"}`,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3 text-sm text-white bg-gradient-to-t from-black/70 to-transparent",children:s.jsxs("div",{className:"space-y-1",children:[x.exif.Make!=="Unknown"&&x.exif.Model!=="Unknown"&&s.jsxs("p",{children:[x.exif.Make," ",x.exif.Model]}),x.exif.LensModel!=="Unknown"&&s.jsx("p",{children:x.exif.LensModel}),x.exif.FocalLength>0&&s.jsxs("p",{children:[x.exif.FocalLength,"mm"]}),x.exif.FNumber>0&&s.jsxs("p",{children:["f/",x.exif.FNumber]}),x.exif.ISO>0&&s.jsx("p",{children:x.exif.ISO}),x.exif.ExposureTime!=="0"&&s.jsxs("p",{children:[x.exif.ExposureTime,"s"]})]})})]})]},x.id))})]});return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`flex flex-col items-center justify-center min-h-screen ${n?"bg-black":"bg-gray-100"} ${e?"demo-mode":"pt-12"}`,children:s.jsx("div",{className:`w-full max-w-4xl ${e?"p-0 demo-content":"p-4 -mt-48"}`,children:e?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(x=>s.jsxs("div",{className:`relative aspect-[3/2] ${n?"bg-black":"bg-gray-100"} rounded-lg overflow-hidden`,children:[s.jsx("img",{src:x.url,alt:x.name,className:"w-full h-full object-contain"}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3 text-sm text-white bg-gradient-to-t from-black/70 to-transparent",children:s.jsxs("div",{className:"space-y-1",children:[x.exif.Make!=="Unknown"&&x.exif.Model!=="Unknown"&&s.jsxs("p",{children:[x.exif.Make," ",x.exif.Model]}),x.exif.LensModel!=="Unknown"&&s.jsx("p",{children:x.exif.LensModel}),x.exif.FocalLength>0&&s.jsxs("p",{children:[x.exif.FocalLength,"mm"]}),x.exif.FNumber>0&&s.jsxs("p",{children:["f/",x.exif.FNumber]}),x.exif.ISO>0&&s.jsx("p",{children:x.exif.ISO}),x.exif.ExposureTime!=="0"&&s.jsxs("p",{children:[x.exif.ExposureTime,"s"]})]})})]},x.id))}):s.jsx(s.Fragment,{children:l?s.jsx("div",{className:"text-center",children:s.jsx("p",{className:n?"text-gray-300":"text-gray-600",children:"..."})}):o.length===0?s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsxs("div",{className:`flex flex-col items-center justify-center w-[480px] h-[320px] border-4 border-dashed rounded-2xl p-8 cursor-pointer
                    ${n?"border-gray-800 text-gray-300 bg-black":"border-gray-300 text-gray-600"}
                    transition-all duration-200 
                    ${n?"hover:border-sky-500/50 hover:bg-sky-500/10":"hover:border-sky-500/50 hover:bg-sky-500/5"}`,onClick:A,onDrop:I,onDragOver:D,children:[s.jsx("svg",{className:`mx-auto h-12 w-12 ${n?"text-gray-600":"text-gray-500"}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})}),s.jsx("h3",{className:"mt-4 text-base font-medium",children:""}),s.jsx("p",{className:"mt-2 text-sm text-gray-500",children:""}),s.jsx("p",{className:`mt-1 text-xs ${n?"text-gray-600":"text-gray-400"}`,children:"JPGPNGGIFWebPHEICRAW"})]}),s.jsxs("div",{className:"mt-4 flex items-center text-xs text-gray-500",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),s.jsx("span",{children:""})]})]}):Y()})})}),s.jsx(ns,{isOpen:h,files:g,onClose:C,onConfirm:ke,onCancel:ce,isConverting:X})]})},tr=({imageInfo:n})=>{const{darkMode:e,exifSettings:t}=Le(),[r,i]=b.useState("");b.useEffect(()=>{const d=new Image;d.onload=()=>{i(`${d.naturalWidth}  ${d.naturalHeight}`)},d.src=n.url},[n.url]);const o=Object.entries({...n.exif,Resolution:r}).filter(([d,g])=>t[d]&&g!=="Unknown"&&(typeof g=="number"?g!==0:!0)&&g!=="");if(o.length===0)return null;const a=(d,g)=>{switch(d){case"FocalLength":return`${g}mm`;case"FNumber":return`f/${g}`;case"ExposureTime":return`${g}s`;case"DateTimeOriginal":return new Date(g).toLocaleString();case"ISO":return g.toString();case"Resolution":case"FileName":case"Make":case"Model":case"LensModel":return String(g);default:return String(g)}},l=o.reduce((d,[g,m])=>g==="Make"||g==="Model"?(d.camera||(d.camera=[]),d.camera.push(String(m)),d):{...d,[g]:m},{}),c={},h={};return Object.entries(l).forEach(([d,g])=>{d==="camera"||d==="FocalLength"||d==="FNumber"||d==="ExposureTime"||d==="ISO"?c[d]=g:h[d]=g}),s.jsxs("div",{className:"absolute bottom-4 left-0 right-0 flex flex-col items-center space-y-2 pointer-events-none z-10",children:[Object.keys(c).length>0&&s.jsx("div",{className:`max-w-[95%] md:max-w-[85%] overflow-x-auto rounded-full px-5 py-2 backdrop-blur-md text-sm
          ${e?"bg-black/60 text-gray-100 shadow-lg shadow-black/30":"bg-white/70 text-gray-700 shadow-lg shadow-black/10"} 
          transition-all duration-300 scrollbar-hide pointer-events-auto select-none`,children:s.jsx("div",{className:"flex items-center space-x-2 flex-nowrap",children:Object.entries(c).map(([d,g])=>d==="camera"&&Array.isArray(g)?s.jsx("div",{className:"font-medium whitespace-nowrap",children:g.join(" ")},"camera"):s.jsxs("div",{className:"font-medium whitespace-nowrap flex items-center",children:[d!=="camera"&&s.jsx("span",{className:"mx-2 h-1 w-1 rounded-full bg-current opacity-40 flex-shrink-0"}),String(a(d,g))]},d))})}),Object.keys(h).length>0&&s.jsx("div",{className:`max-w-[80%] md:max-w-[60%] px-4 py-1.5 text-xs select-none
            ${e?"text-gray-300/80":"text-gray-600/80"} 
            transition-all duration-300 pointer-events-auto`,children:s.jsx("div",{className:"flex items-center justify-center flex-wrap gap-x-3 gap-y-1",children:Object.entries(h).map(([d,g])=>s.jsx("div",{className:"flex items-center whitespace-nowrap",children:a(d,g)},d))})})]})},me=hn((n,e)=>({isAnnotateMode:!1,setAnnotateMode:t=>n({isAnnotateMode:t}),annotationToolbar:{visible:!1,position:{x:100,y:100}},setToolbarVisible:t=>n(r=>({annotationToolbar:{...r.annotationToolbar,visible:t}})),setToolbarPosition:t=>n(r=>({annotationToolbar:{...r.annotationToolbar,position:t}})),annotationTool:"rect",setAnnotationTool:t=>n({annotationTool:t}),annotationStrokeWidth:2,setStrokeWidth:t=>n({annotationStrokeWidth:t}),annotationColor:"#FF0000",setAnnotationColor:t=>n({annotationColor:t}),annotationFontSize:18,setAnnotationFontSize:t=>n({annotationFontSize:t}),annotations:{},addAnnotation:(t,r)=>n(i=>({annotations:{...i.annotations,[t]:[...i.annotations[t]||[],r]}})),setAnnotations:(t,r)=>n(i=>({annotations:{...i.annotations,[t]:r}})),clearAnnotations:t=>n(r=>({annotations:{...r.annotations,[t]:[]}})),selectedAnnotationId:{},setSelectedAnnotationId:(t,r)=>n(i=>({selectedAnnotationId:{...i.selectedAnnotationId,[t]:r}})),moveAnnotation:(t,r,i,o)=>n(a=>{const l=a.annotations[t]||[],c=l.findIndex(m=>m.id===r);if(c===-1)return{};const h=l[c];let d=h.points;h.type==="rect"||h.type==="ellipse"?d=[h.points[0]+i,h.points[1]+o,h.points[2]+i,h.points[3]+o]:h.type==="pen"?d=h.points.map((m,S)=>S%2===0?m+i:m+o):h.type==="text"&&(d=[h.points[0]+i,h.points[1]+o]);const g=[...l];return g[c]={...h,points:d},{annotations:{...a.annotations,[t]:g}}}),deleteAnnotation:(t,r)=>n(i=>{const o=i.annotations[t]||[];if(o.findIndex(c=>c.id===r)===-1)return{};e().pushUndo(t,o);const l=o.filter(c=>c.id!==r);return{annotations:{...i.annotations,[t]:l},selectedAnnotationId:{...i.selectedAnnotationId,[t]:null}}}),undoStack:{},redoStack:{},pushUndo:(t,r)=>n(i=>({undoStack:{...i.undoStack,[t]:[...i.undoStack[t]||[],JSON.parse(JSON.stringify(r))]},redoStack:{...i.redoStack,[t]:[]}})),undo:t=>n(r=>{const i=r.undoStack[t]||[];if(i.length===0)return{};const o=r.redoStack[t]||[],a=i[i.length-1];return{annotations:{...r.annotations,[t]:a},undoStack:{...r.undoStack,[t]:i.slice(0,-1)},redoStack:{...r.redoStack,[t]:[...o,r.annotations[t]||[]]}}}),redo:t=>n(r=>{const i=r.redoStack[t]||[];if(i.length===0)return{};const o=r.undoStack[t]||[],a=i[i.length-1];return{annotations:{...r.annotations,[t]:a},redoStack:{...r.redoStack,[t]:i.slice(0,-1)},undoStack:{...r.undoStack,[t]:[...o,r.annotations[t]||[]]}}}),drawing:null,setDrawing:t=>n({drawing:t}),editingTextId:null,setEditingTextId:t=>n({editingTextId:t})})),as=({images:n=[]})=>{var In,En,An,Mn,Tn,Nn;const{darkMode:e,syncZoom:t,demoMode:r,showZoomControls:i}=Le(),{removeImage:o,addImages:a}=dt(),{isAnnotateMode:l,annotationTool:c,annotationColor:h,annotationStrokeWidth:d,annotationFontSize:g,annotations:m,addAnnotation:S,setAnnotations:j,undo:X,redo:U,selectedAnnotationId:$,setSelectedAnnotationId:R,drawing:p,setDrawing:le,editingTextId:ke,setEditingTextId:ce,deleteAnnotation:C}=me(),I=b.useRef([]),D=b.useRef([]),[A,Y]=b.useState([]),[x,k]=b.useState(!1),[N,O]=b.useState(null),[Z,z]=b.useState({width:0,height:0}),[ie,pe]=b.useState(null),[xe,J]=b.useState(null),[Ie,ye]=b.useState(!1),[Ce,T]=b.useState(null),[G,ee]=b.useState(""),[Q,f]=b.useState(null),w=b.useRef(null),be=b.useRef(A);b.useEffect(()=>{be.current=A},[A]);const _=b.useRef(t);b.useEffect(()=>{_.current=t},[t]),b.useEffect(()=>{var u;if(n.length===1){const E=(((u=n[0].exif)==null?void 0:u.Resolution)||"").match(/(\d+)\s*[x]\s*(\d+)/);if(E){const P=parseInt(E[1],10),B=parseInt(E[2],10);z({width:P,height:B}),pe([0,0,P,B])}}},[n]),b.useEffect(()=>{Y(Array(n.length).fill({scale:1,x:0,y:0}))},[n.length]);const se=b.useRef({isDragging:!1,currentIndex:-1,startX:0,startY:0});b.useEffect(()=>{I.current=I.current.slice(0,n.length),D.current=D.current.slice(0,n.length)},[n.length]);const je=(u,v)=>{Y(E=>{if(_.current){const P=v(E[u]||{scale:1,x:0,y:0});return E.map(()=>({...P}))}else{const P=[...E];return P[u]=v(E[u]||{scale:1,x:0,y:0}),P}})};b.useEffect(()=>{const u=I.current,v=[],E=[];u.forEach((q,K)=>{if(!q)return;const ne=M=>{M.preventDefault(),je(K,F=>{const L=M.deltaY*-.01,V=Math.max(.1,Math.min(10,F.scale+L));return{...F,scale:V}})},y=M=>{if(M.target.tagName!=="IMG"||l)return;const F=be.current[K]||{x:0,y:0};se.current={isDragging:!0,currentIndex:K,startX:M.clientX-F.x,startY:M.clientY-F.y},window.addEventListener("mousemove",P),window.addEventListener("mouseup",B),M.preventDefault()};q.addEventListener("wheel",ne,{passive:!1}),q.addEventListener("mousedown",y),v[K]=ne,E[K]=y});function P(q){if(!se.current.isDragging)return;const{currentIndex:K,startX:ne,startY:y}=se.current;je(K,M=>({...M,x:q.clientX-ne,y:q.clientY-y}))}function B(){se.current.isDragging=!1,window.removeEventListener("mousemove",P),window.removeEventListener("mouseup",B)}return()=>{u.forEach((q,K)=>{q&&(v[K]&&q.removeEventListener("wheel",v[K]),E[K]&&q.removeEventListener("mousedown",E[K]))}),window.removeEventListener("mousemove",P),window.removeEventListener("mouseup",B)}},[l,n.length]);const Be=u=>{const v=u.currentTarget;if(typeof v.createSVGPoint!="function")return[u.nativeEvent.offsetX,u.nativeEvent.offsetY];const E=v.createSVGPoint();E.x=u.clientX,E.y=u.clientY;const P=v.getScreenCTM();if(!P)return[0,0];const B=E.matrixTransform(P.inverse());return[B.x,B.y]};b.useEffect(()=>{if(!ke)return;let u=!0;const v=E=>{const P=document.querySelector(".text-popover");setTimeout(()=>{if(u){u=!1;return}P&&!P.contains(E.target)&&(console.log("[window mousedown] "),ce==null||ce(null),J(null))},0)};return window.addEventListener("mousedown",v),()=>window.removeEventListener("mousedown",v)},[ke]);const Sn=(u,v)=>{var B;if(!l||N||p&&p.imageId!==n[v].id)return;const[E,P]=Be(u);if(c==="move"){const q=m[n[v].id]||[];let K=!1;for(let ne=q.length-1;ne>=0;ne--){const y=q[ne];if(y.type==="rect"||y.type==="ellipse"){const[M,F,L,V]=y.points;if(E>=Math.min(M,L)&&E<=Math.max(M,L)&&P>=Math.min(F,V)&&P<=Math.max(F,V)){R(n[v].id,y.id),K=!0;break}}else if(y.type==="pen"){for(let M=0;M<y.points.length;M+=2)if(Math.abs(y.points[M]-E)<8&&Math.abs(y.points[M+1]-P)<8){R(n[v].id,y.id),K=!0;break}}else if(y.type==="text"){const[M,F]=y.points;if(Math.abs(M-E)<40&&Math.abs(F-P)<24){R(n[v].id,y.id),K=!0;break}}}K||R(n[v].id,null);return}if(c==="text"){const K=u.currentTarget.getBoundingClientRect(),ne=((B=A[v])==null?void 0:B.scale)||1,y=(u.clientX-K.left)/ne,M=(u.clientY-K.top)/ne;ye(!0),T({left:u.clientX,top:u.clientY}),f([y,M]),ee("");return}le(c==="pen"?{type:"pen",start:[E,P],points:[E,P],imageId:n[v].id}:{type:c,start:[E,P],points:[E,P,E,P],imageId:n[v].id})},W=8,$e=4,ve=9,Pe=4,We=({cx:u,cy:v,onPointerUp:E})=>{const[P,B]=b.useState(!1);return s.jsxs("g",{style:{cursor:"pointer"},onPointerDown:q=>{q.stopPropagation()},onPointerUp:E,onMouseEnter:()=>B(!0),onMouseLeave:()=>B(!1),children:[s.jsx("circle",{cx:u,cy:v,r:ve,fill:P?"#007AFF":"#fff",stroke:"#007AFF",strokeWidth:1.5}),s.jsx("path",{d:`M${u-3},${v-3} L${u+3},${v+3} M${u-3},${v+3} L${u+3},${v-3}`,stroke:P?"#fff":"#007AFF",strokeWidth:1.5,strokeLinecap:"round"})]})},[He,ze]=b.useState(null),kn=(u,v)=>{var B;if(!l)return;if(He){const q=u.clientX-He.x,K=u.clientY-He.y;(Math.abs(q)>2||Math.abs(K)>2)&&(O({imgIdx:He.imgIdx,annId:He.annId,start:[He.x,He.y],last:[u.clientX,u.clientY]}),ze(null));return}if(N){const[q,K]=[u.clientX,u.clientY],ne=q-N.last[0],y=K-N.last[1],M=((B=A[v])==null?void 0:B.scale)||1,F=ne/M,L=y/M;(Math.abs(F)>.01||Math.abs(L)>.01)&&(_.current?n.forEach(V=>{$[V.id]&&me.getState().moveAnnotation(V.id,$[V.id],F,L)}):me.getState().moveAnnotation(n[v].id,N.annId,F,L),O({...N,last:[q,K]}));return}if(!p||p.imageId!==n[v].id)return;const[E,P]=Be(u);p&&p.type==="pen"?le({...p,points:[...p.points,E,P]}):p&&le({...p,points:[p.start[0],p.start[1],E,P]})},Cn=(u,v)=>{if(!l)return;if(He){ze(null);return}if(N){O(null);return}if(!p||p.imageId!==n[v].id)return;const E={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,type:p.type,points:p.points,color:h,strokeWidth:d};_.current?n.forEach(P=>S(P.id,E)):S(n[v].id,E),le(null)};b.useEffect(()=>{if(!l)return;const u=v=>{(v.ctrlKey||v.metaKey)&&v.key.toLowerCase()==="z"&&n.length>0&&X(n[0].id),(v.ctrlKey||v.metaKey)&&v.key.toLowerCase()==="y"&&n.length>0&&U(n[0].id),(v.key==="Delete"||v.key==="Backspace")&&(_.current?n.forEach(E=>{const P=$[E.id];P&&me.getState().deleteAnnotation(E.id,P)}):n.forEach(E=>{const P=$[E.id];P&&me.getState().deleteAnnotation(E.id,P)}))};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[l,n,X,U,$,_]),b.useEffect(()=>{n.length===0&&dt.setState({hasViewedImages:!1})},[n.length]);const jn=()=>{if(G.trim()&&Q){const u={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,type:"text",points:Q,color:h,strokeWidth:d,text:G,fontSize:g};_.current?n.forEach(v=>S(v.id,u)):S(n[0].id,u)}ye(!1),T(null),ee(""),f(null)},Or=Ie&&Ce?yt.createPortal(s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-popover-mask",style:{position:"fixed",inset:0,zIndex:9998,background:"transparent"},onClick:jn}),s.jsx("textarea",{ref:w,value:G,onChange:u=>{ee(u.target.value),w.current&&(w.current.style.width="2px",w.current.style.width=`${Math.max(180,w.current.scrollWidth)}px`)},onKeyDown:u=>{u.key==="Enter"&&!u.shiftKey?(u.preventDefault(),jn()):u.key==="Escape"&&(u.preventDefault(),ye(!1),T(null),ee(""),f(null))},placeholder:"...",style:{position:"fixed",left:Ce.left,top:Ce.top,width:"180px",minWidth:"2px",height:g+4,padding:"0 2px",margin:0,border:"none",outline:"none",background:"transparent",color:h,caretColor:h,fontSize:g,fontFamily:"system-ui, -apple-system, sans-serif",resize:"none",overflow:"hidden",whiteSpace:"nowrap",zIndex:9999,lineHeight:"1",verticalAlign:"middle",transform:"translate(-2px, -50%)",boxSizing:"border-box"}})]}),document.body):null;b.useEffect(()=>{Ie&&w.current&&requestAnimationFrame(()=>{if(w.current){w.current.focus();const u=w.current.value.length;w.current.setSelectionRange(u,u)}})},[Ie]);const[Ur,Gt]=b.useState([]),ft=[1,2,5];b.useEffect(()=>{Gt(Array(n.length).fill(-1))},[n.length]);const Pn=(u,v)=>{Gt(E=>{const P=[...E];return P[u]===v?P[u]=-1:P[u]=v,P}),Y(E=>{const P=[...E];if(Ur[u]===v){if(_.current)return P.map(()=>({scale:1,x:0,y:0}));P[u]={...P[u],scale:1}}else{if(_.current)return P.map(()=>({scale:ft[v],x:0,y:0}));P[u]={...P[u],scale:ft[v]}}return P})};return b.useEffect(()=>{Gt(u=>u.map((v,E)=>{var B;if(v===-1)return-1;const P=((B=A[E])==null?void 0:B.scale)||1;return Math.abs(P-ft[v])>.01?-1:v}))},[A]),n.length===0?null:s.jsxs("div",{className:"fixed inset-0 flex items-center justify-center",children:[n.length===1?s.jsx("div",{className:"w-full md:w-[90%] h-[80vh] px-4 flex items-center justify-center",children:s.jsx("div",{className:"relative w-full h-full flex items-center justify-center",children:s.jsxs("div",{ref:u=>I.current[0]=u,className:`w-full h-full ${e?"bg-black":"bg-white"} rounded-lg shadow-lg overflow-hidden relative group`,children:[i&&s.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 bottom-48 z-30 flex flex-row items-end space-x-3 select-none mb-4",children:ft.map((u,v)=>{var q;const E=((q=A[0])==null?void 0:q.scale)||1;let P=!1;v===0&&E>=1&&E<2&&(P=!0),v===1&&E>=2&&E<5&&(P=!0),v===2&&E>=5&&(P=!0);const B=Number.isInteger(E)?`${E}x`:`${E.toFixed(1)}x`;return s.jsx("button",{onClick:()=>Pn(0,v),className:`w-9 h-9 flex items-center justify-center rounded-full font-semibold transition-all duration-200 shadow-md
                          border border-gray-300 dark:border-gray-700
                          bg-white/80 dark:bg-gray-900/80 backdrop-blur-md
                          hover:bg-sky-100/80 dark:hover:bg-gray-800/90
                          focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-opacity-50
                        `,style:{minWidth:36,minHeight:36,maxWidth:36,maxHeight:36,outline:"none",position:"relative",transform:P?"scale(1.22)":"scale(1)"},title:`${u}x`,children:P?s.jsx("span",{className:"text-gray-700 dark:text-gray-100 font-medium whitespace-nowrap text-[13px] leading-none drop-shadow-sm",children:B}):s.jsxs("span",{className:"text-gray-700 dark:text-gray-200 font-medium whitespace-nowrap text-[13px] leading-none drop-shadow-sm",children:[u,"x"]})},u)})}),s.jsx("img",{ref:u=>D.current[0]=u,src:n[0].url,alt:n[0].exif.FileName,className:"w-full h-full object-contain select-none",style:{transform:`translate(${((In=A[0])==null?void 0:In.x)||0}px, ${((En=A[0])==null?void 0:En.y)||0}px) scale(${((An=A[0])==null?void 0:An.scale)||1})`,touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},draggable:!1}),s.jsxs("svg",{className:"absolute inset-0 w-full h-full z-20",style:{transform:`translate(${((Mn=A[0])==null?void 0:Mn.x)||0}px, ${((Tn=A[0])==null?void 0:Tn.y)||0}px) scale(${((Nn=A[0])==null?void 0:Nn.scale)||1})`,pointerEvents:l?Ie?"none":"auto":"none",touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},onPointerDown:l?u=>Sn(u,0):void 0,onPointerMove:l?u=>kn(u,0):void 0,onPointerUp:l?u=>Cn(u,0):void 0,children:[(m[n[0].id]||[]).map((u,v)=>{var P;const E=$[n[0].id]===u.id;if(u.type==="rect"){const[B,q,K,ne]=u.points,y=Math.min(B,K),M=Math.min(q,ne),F=Math.abs(K-B),L=Math.abs(ne-q);return s.jsxs("g",{children:[s.jsx("rect",{x:y,y:M,width:F,height:L,stroke:u.color,strokeWidth:u.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",onPointerDown:V=>{V.stopPropagation(),R(n[0].id,u.id),c==="move"&&(_.current?n.forEach(oe=>me.getState().pushUndo(oe.id,m[oe.id]||[])):me.getState().pushUndo(n[0].id,m[n[0].id]||[])),ze({x:V.clientX,y:V.clientY,annId:u.id,imgIdx:0})}}),c==="move"&&E&&s.jsxs("g",{children:[s.jsx("rect",{x:y-W,y:M-W,width:F+W*2,height:L+W*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:$e,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:V=>{V.stopPropagation(),O({imgIdx:0,annId:u.id,start:[V.clientX,V.clientY],last:[V.clientX,V.clientY]})}}),s.jsx(We,{cx:y+F+W+ve+Pe,cy:M-W-ve-Pe,onPointerUp:V=>{V.stopPropagation(),_.current?n.forEach(oe=>C(oe.id,u.id)):C(n[0].id,u.id)}})]})]},u.id)}if(u.type==="ellipse"){const[B,q,K,ne]=u.points,y=Math.min(B,K),M=Math.min(q,ne),F=Math.abs(K-B),L=Math.abs(ne-q);return s.jsxs("g",{children:[s.jsx("ellipse",{cx:(B+K)/2,cy:(q+ne)/2,rx:F/2,ry:L/2,stroke:u.color,strokeWidth:u.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",onPointerDown:V=>{V.stopPropagation(),R(n[0].id,u.id),c==="move"&&(_.current?n.forEach(oe=>me.getState().pushUndo(oe.id,m[oe.id]||[])):me.getState().pushUndo(n[0].id,m[n[0].id]||[])),ze({x:V.clientX,y:V.clientY,annId:u.id,imgIdx:0})}}),c==="move"&&E&&s.jsxs("g",{children:[s.jsx("rect",{x:y-W,y:M-W,width:F+W*2,height:L+W*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:$e,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:V=>{V.stopPropagation(),O({imgIdx:0,annId:u.id,start:[V.clientX,V.clientY],last:[V.clientX,V.clientY]})}}),s.jsx(We,{cx:y+F+W+ve+Pe,cy:M-W-ve-Pe,onPointerUp:V=>{V.stopPropagation(),_.current?n.forEach(oe=>C(oe.id,u.id)):C(n[0].id,u.id)}})]})]},u.id)}if(u.type==="pen"){const B=u.points,q=B.length>=4?`M${B[0]},${B[1]} `+B.slice(2).map((F,L)=>L%2===0?`L${B[L+2]},${B[L+3]}`:"").join(" "):"";let K=1/0,ne=1/0,y=-1/0,M=-1/0;for(let F=0;F<B.length;F+=2)K=Math.min(K,B[F]),ne=Math.min(ne,B[F+1]),y=Math.max(y,B[F]),M=Math.max(M,B[F+1]);return s.jsxs("g",{children:[s.jsx("path",{d:q,stroke:u.color,strokeWidth:u.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",onPointerDown:F=>{F.stopPropagation(),R(n[0].id,u.id),c==="move"&&(_.current?n.forEach(L=>me.getState().pushUndo(L.id,m[L.id]||[])):me.getState().pushUndo(n[0].id,m[n[0].id]||[])),ze({x:F.clientX,y:F.clientY,annId:u.id,imgIdx:0})}}),c==="move"&&E&&s.jsxs("g",{children:[s.jsx("rect",{x:K-W,y:ne-W,width:y-K+W*2,height:M-ne+W*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:$e,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:F=>{F.stopPropagation(),O({imgIdx:0,annId:u.id,start:[F.clientX,F.clientY],last:[F.clientX,F.clientY]})}}),s.jsx(We,{cx:y+W+ve+Pe,cy:ne-W-ve-Pe,onPointerUp:F=>{F.stopPropagation(),_.current?n.forEach(L=>C(L.id,u.id)):C(n[0].id,u.id)}})]})]},u.id)}if(u.type==="text"){const[B,q]=u.points,K=(((P=u.text)==null?void 0:P.length)||0)*(u.fontSize||18)*.96,ne=Math.max(120,K+16),y=40;return ke===u.id?null:s.jsxs("g",{children:[s.jsx("text",{x:B,y:q,fontSize:u.fontSize||18,fill:u.color,textAnchor:"start",alignmentBaseline:"middle",style:{cursor:c==="move"?"move":"text",userSelect:"none",...E?{filter:"drop-shadow(0 0 2px #007AFF88)"}:{}},onDoubleClick:()=>ce==null?void 0:ce(u.id),onPointerDown:M=>{M.stopPropagation(),c==="move"&&(R(n[0].id,u.id),O({imgIdx:0,annId:u.id,start:[M.clientX,M.clientY],last:[M.clientX,M.clientY]}))},children:u.text}),c==="move"&&E&&s.jsxs("g",{children:[s.jsx("rect",{x:B-W,y:q-y/2-W,width:ne+W*2,height:y+W*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:$e,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:M=>{M.stopPropagation(),O({imgIdx:0,annId:u.id,start:[M.clientX,M.clientY],last:[M.clientX,M.clientY]})}}),s.jsx(We,{cx:B+ne+W+ve+Pe,cy:q-y/2-W-ve-Pe,onPointerUp:M=>{M.stopPropagation(),_.current?n.forEach(F=>C(F.id,u.id)):C(n[0].id,u.id)}})]})]},u.id)}return null}),p&&(_.current||n[0].id===p.imageId)&&(p.type==="rect"?s.jsx("rect",{x:Math.min(p.start[0],p.points[2]),y:Math.min(p.start[1],p.points[3]),width:Math.abs(p.points[2]-p.start[0]),height:Math.abs(p.points[3]-p.start[1]),stroke:h,strokeWidth:d,vectorEffect:"non-scaling-stroke",fill:"none",pointerEvents:"none"}):p.type==="ellipse"?s.jsx("ellipse",{cx:(p.start[0]+p.points[2])/2,cy:(p.start[1]+p.points[3])/2,rx:Math.abs(p.points[2]-p.start[0])/2,ry:Math.abs(p.points[3]-p.start[1])/2,stroke:h,strokeWidth:d,vectorEffect:"non-scaling-stroke",fill:"none",pointerEvents:"none"}):p.type==="pen"&&p.points.length>=4?s.jsx("path",{d:`M${p.points[0]},${p.points[1]} `+p.points.slice(2).map((u,v)=>v%2===0?`L${p.points[v+2]},${p.points[v+3]}`:"").join(" "),stroke:h,strokeWidth:d,vectorEffect:"non-scaling-stroke",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"}):null)]}),s.jsx(tr,{imageInfo:n[0]})]})},n[0].id)}):s.jsx("div",{className:"grid gap-4 w-full md:w-[90%] h-full items-center justify-center px-4 mx-auto",style:{gridTemplateColumns:`repeat(${n.length}, minmax(0, 1fr))`},children:n.map((u,v)=>{var E,P,B,q,K,ne;return s.jsx("div",{className:"relative w-full h-full flex items-center justify-center",children:s.jsxs("div",{ref:y=>I.current[v]=y,className:`w-full h-[80vh] ${e?"bg-black":"bg-white"} rounded-lg shadow-lg overflow-hidden relative group`,children:[i&&s.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 bottom-48 z-30 flex flex-row items-end space-x-3 select-none mb-4",children:ft.map((y,M)=>{var oe;const F=((oe=A[v])==null?void 0:oe.scale)||1;let L=!1;M===0&&F>=1&&F<2&&(L=!0),M===1&&F>=2&&F<5&&(L=!0),M===2&&F>=5&&(L=!0);const V=Number.isInteger(F)?`${F}x`:`${F.toFixed(1)}x`;return s.jsx("button",{onClick:()=>Pn(v,M),className:`w-9 h-9 flex items-center justify-center rounded-full font-semibold transition-all duration-200 shadow-md
                            border border-gray-300 dark:border-gray-700
                            bg-white/80 dark:bg-gray-900/80 backdrop-blur-md
                            hover:bg-sky-100/80 dark:hover:bg-gray-800/90
                            focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-opacity-50
                          `,style:{minWidth:36,minHeight:36,maxWidth:36,maxHeight:36,outline:"none",position:"relative",transform:L?"scale(1.22)":"scale(1)"},title:`${y}x`,children:L?s.jsx("span",{className:"text-gray-700 dark:text-gray-100 font-medium whitespace-nowrap text-[13px] leading-none drop-shadow-sm",children:V}):s.jsxs("span",{className:"text-gray-700 dark:text-gray-200 font-medium whitespace-nowrap text-[13px] leading-none drop-shadow-sm",children:[y,"x"]})},y)})}),s.jsx("img",{ref:y=>D.current[v]=y,src:u.url,alt:u.exif.FileName,className:"w-full h-full object-contain select-none",style:{transform:`translate(${((E=A[v])==null?void 0:E.x)||0}px, ${((P=A[v])==null?void 0:P.y)||0}px) scale(${((B=A[v])==null?void 0:B.scale)||1})`,touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},draggable:!1}),s.jsxs("svg",{className:"absolute inset-0 w-full h-full z-20",style:{transform:`translate(${((q=A[v])==null?void 0:q.x)||0}px, ${((K=A[v])==null?void 0:K.y)||0}px) scale(${((ne=A[v])==null?void 0:ne.scale)||1})`,pointerEvents:l?"auto":"none",touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},onPointerDown:l?y=>Sn(y,v):void 0,onPointerMove:l?y=>kn(y,v):void 0,onPointerUp:l?y=>Cn(y,v):void 0,children:[(m[u.id]||[]).map(y=>{var F;const M=$[u.id]===y.id;if(y.type==="rect"){const[L,V,oe,Ee]=y.points,Ae=Math.min(L,oe),ae=Math.min(V,Ee),re=Math.abs(oe-L),Te=Math.abs(Ee-V);return s.jsxs("g",{children:[s.jsx("rect",{x:Ae,y:ae,width:re,height:Te,stroke:y.color,strokeWidth:y.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",onPointerDown:de=>{de.stopPropagation(),R(u.id,y.id),c==="move"&&(_.current?n.forEach(Oe=>me.getState().pushUndo(Oe.id,m[Oe.id]||[])):me.getState().pushUndo(u.id,m[u.id]||[])),ze({x:de.clientX,y:de.clientY,annId:y.id,imgIdx:v})}}),c==="move"&&M&&s.jsxs("g",{children:[s.jsx("rect",{x:Ae-W,y:ae-W,width:re+W*2,height:Te+W*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:$e,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:de=>{de.stopPropagation(),O({imgIdx:v,annId:y.id,start:[de.clientX,de.clientY],last:[de.clientX,de.clientY]})}}),s.jsx(We,{cx:Ae+re+W+ve+Pe,cy:ae-W-ve-Pe,onPointerUp:de=>{de.stopPropagation(),_.current?n.forEach(Oe=>C(Oe.id,y.id)):C(u.id,y.id)}})]})]},y.id)}if(y.type==="ellipse"){const[L,V,oe,Ee]=y.points,Ae=Math.min(L,oe),ae=Math.min(V,Ee),re=Math.abs(oe-L),Te=Math.abs(Ee-V);return s.jsxs("g",{children:[s.jsx("ellipse",{cx:(L+oe)/2,cy:(V+Ee)/2,rx:re/2,ry:Te/2,stroke:y.color,strokeWidth:y.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",onPointerDown:de=>{de.stopPropagation(),R(u.id,y.id),c==="move"&&(_.current?n.forEach(Oe=>me.getState().pushUndo(Oe.id,m[Oe.id]||[])):me.getState().pushUndo(u.id,m[u.id]||[])),ze({x:de.clientX,y:de.clientY,annId:y.id,imgIdx:v})}}),c==="move"&&M&&s.jsxs("g",{children:[s.jsx("rect",{x:Ae-W,y:ae-W,width:re+W*2,height:Te+W*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:$e,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:de=>{de.stopPropagation(),O({imgIdx:v,annId:y.id,start:[de.clientX,de.clientY],last:[de.clientX,de.clientY]})}}),s.jsx(We,{cx:Ae+re+W+ve+Pe,cy:ae-W-ve-Pe,onPointerUp:de=>{de.stopPropagation(),_.current?n.forEach(Oe=>C(Oe.id,y.id)):C(u.id,y.id)}})]})]},y.id)}if(y.type==="pen"){const L=y.points,V=L.length>=4?`M${L[0]},${L[1]} `+L.slice(2).map((re,Te)=>Te%2===0?`L${L[Te+2]},${L[Te+3]}`:"").join(" "):"";let oe=1/0,Ee=1/0,Ae=-1/0,ae=-1/0;for(let re=0;re<L.length;re+=2)oe=Math.min(oe,L[re]),Ee=Math.min(Ee,L[re+1]),Ae=Math.max(Ae,L[re]),ae=Math.max(ae,L[re+1]);return s.jsxs("g",{children:[s.jsx("path",{d:V,stroke:y.color,strokeWidth:y.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",onPointerDown:re=>{re.stopPropagation(),R(u.id,y.id),c==="move"&&(_.current?n.forEach(Te=>me.getState().pushUndo(Te.id,m[Te.id]||[])):me.getState().pushUndo(u.id,m[u.id]||[])),ze({x:re.clientX,y:re.clientY,annId:y.id,imgIdx:v})}}),c==="move"&&M&&s.jsxs("g",{children:[s.jsx("rect",{x:oe-W,y:Ee-W,width:Ae-oe+W*2,height:ae-Ee+W*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:$e,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:re=>{re.stopPropagation(),O({imgIdx:v,annId:y.id,start:[re.clientX,re.clientY],last:[re.clientX,re.clientY]})}}),s.jsx(We,{cx:Ae+W+ve+Pe,cy:Ee-W-ve-Pe,onPointerUp:re=>{re.stopPropagation(),_.current?n.forEach(Te=>C(Te.id,y.id)):C(u.id,y.id)}})]})]},y.id)}if(y.type==="text"){const[L,V]=y.points,oe=(((F=y.text)==null?void 0:F.length)||0)*(y.fontSize||18)*.96,Ee=Math.max(120,oe+16),Ae=40;return ke===y.id?null:s.jsxs("g",{children:[s.jsx("text",{x:L,y:V,fontSize:y.fontSize||18,fill:y.color,textAnchor:"start",alignmentBaseline:"middle",style:{cursor:c==="move"?"move":"text",userSelect:"none",...M?{filter:"drop-shadow(0 0 2px #007AFF88)"}:{}},onDoubleClick:()=>ce==null?void 0:ce(y.id),onPointerDown:ae=>{ae.stopPropagation(),c==="move"&&(R(u.id,y.id),O({imgIdx:v,annId:y.id,start:[ae.clientX,ae.clientY],last:[ae.clientX,ae.clientY]}))},children:y.text}),c==="move"&&M&&s.jsxs("g",{children:[s.jsx("rect",{x:L-W,y:V-Ae/2-W,width:Ee+W*2,height:Ae+W*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:$e,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:ae=>{ae.stopPropagation(),O({imgIdx:v,annId:y.id,start:[ae.clientX,ae.clientY],last:[ae.clientX,ae.clientY]})}}),s.jsx(We,{cx:L+Ee+W+ve+Pe,cy:V-Ae/2-W-ve-Pe,onPointerUp:ae=>{ae.stopPropagation(),_.current?n.forEach(re=>C(re.id,y.id)):C(u.id,y.id)}})]})]},y.id)}return null}),p&&(_.current||u.id===p.imageId)&&(p.type==="rect"?s.jsx("rect",{x:Math.min(p.start[0],p.points[2]),y:Math.min(p.start[1],p.points[3]),width:Math.abs(p.points[2]-p.start[0]),height:Math.abs(p.points[3]-p.start[1]),stroke:h,strokeWidth:d,vectorEffect:"non-scaling-stroke",fill:"none",pointerEvents:"none"}):p.type==="ellipse"?s.jsx("ellipse",{cx:(p.start[0]+p.points[2])/2,cy:(p.start[1]+p.points[3])/2,rx:Math.abs(p.points[2]-p.start[0])/2,ry:Math.abs(p.points[3]-p.start[1])/2,stroke:h,strokeWidth:d,vectorEffect:"non-scaling-stroke",fill:"none",pointerEvents:"none"}):p.type==="pen"&&p.points.length>=4?s.jsx("path",{d:`M${p.points[0]},${p.points[1]} `+p.points.slice(2).map((y,M)=>M%2===0?`L${p.points[M+2]},${p.points[M+3]}`:"").join(" "),stroke:h,strokeWidth:d,vectorEffect:"non-scaling-stroke",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"}):null)]}),!r&&s.jsx("button",{onClick:()=>{o(u.id)},className:`absolute top-2 right-2 z-50 p-1.5 rounded-full transition-all duration-200 opacity-0 group-hover:opacity-100
                      ${e?"bg-gray-800/90 text-gray-100 hover:bg-gray-700":"bg-white/80 text-gray-700 hover:bg-white"}`,title:"",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx(tr,{imageInfo:u})]})},u.id)})}),Or]})};var Mr={exports:{}};(function(n){(function(e){var t=p(),r=le(),i=ke(),o=ce(),a={imagePlaceholder:void 0,cacheBust:!1},l={toSvg:c,toPng:d,toJpeg:g,toBlob:m,toPixelData:h,impl:{fontFaces:i,images:o,util:t,inliner:r,options:{}}};n.exports=l;function c(C,I){return I=I||{},S(I),Promise.resolve(C).then(function(A){return X(A,I.filter,!0)}).then(U).then($).then(D).then(function(A){return R(A,I.width||t.width(C),I.height||t.height(C))});function D(A){return I.bgcolor&&(A.style.backgroundColor=I.bgcolor),I.width&&(A.style.width=I.width+"px"),I.height&&(A.style.height=I.height+"px"),I.style&&Object.keys(I.style).forEach(function(Y){A.style[Y]=I.style[Y]}),A}}function h(C,I){return j(C,I||{}).then(function(D){return D.getContext("2d").getImageData(0,0,t.width(C),t.height(C)).data})}function d(C,I){return j(C,I||{}).then(function(D){return D.toDataURL()})}function g(C,I){return I=I||{},j(C,I).then(function(D){return D.toDataURL("image/jpeg",I.quality||1)})}function m(C,I){return j(C,I||{}).then(t.canvasToBlob)}function S(C){typeof C.imagePlaceholder>"u"?l.impl.options.imagePlaceholder=a.imagePlaceholder:l.impl.options.imagePlaceholder=C.imagePlaceholder,typeof C.cacheBust>"u"?l.impl.options.cacheBust=a.cacheBust:l.impl.options.cacheBust=C.cacheBust}function j(C,I){return c(C,I).then(t.makeImage).then(t.delay(100)).then(function(A){var Y=D(C);return Y.getContext("2d").drawImage(A,0,0),Y});function D(A){var Y=document.createElement("canvas");if(Y.width=I.width||t.width(A),Y.height=I.height||t.height(A),I.bgcolor){var x=Y.getContext("2d");x.fillStyle=I.bgcolor,x.fillRect(0,0,Y.width,Y.height)}return Y}}function X(C,I,D){if(!D&&I&&!I(C))return Promise.resolve();return Promise.resolve(C).then(A).then(function(k){return Y(C,k,I)}).then(function(k){return x(C,k)});function A(k){return k instanceof HTMLCanvasElement?t.makeImage(k.toDataURL()):k.cloneNode(!1)}function Y(k,N,O){var Z=k.childNodes;if(Z.length===0)return Promise.resolve(N);return z(N,t.asArray(Z),O).then(function(){return N});function z(ie,pe,xe){var J=Promise.resolve();return pe.forEach(function(Ie){J=J.then(function(){return X(Ie,xe)}).then(function(ye){ye&&ie.appendChild(ye)})}),J}}function x(k,N){if(!(N instanceof Element))return N;return Promise.resolve().then(O).then(Z).then(z).then(ie).then(function(){return N});function O(){pe(window.getComputedStyle(k),N.style);function pe(xe,J){xe.cssText?J.cssText=xe.cssText:Ie(xe,J);function Ie(ye,Ce){t.asArray(ye).forEach(function(T){Ce.setProperty(T,ye.getPropertyValue(T),ye.getPropertyPriority(T))})}}}function Z(){[":before",":after"].forEach(function(xe){pe(xe)});function pe(xe){var J=window.getComputedStyle(k,xe),Ie=J.getPropertyValue("content");if(Ie===""||Ie==="none")return;var ye=t.uid();N.className=N.className+" "+ye;var Ce=document.createElement("style");Ce.appendChild(T(ye,xe,J)),N.appendChild(Ce);function T(G,ee,Q){var f="."+G+":"+ee,w=Q.cssText?be(Q):_(Q);return document.createTextNode(f+"{"+w+"}");function be(se){var je=se.getPropertyValue("content");return se.cssText+" content: "+je+";"}function _(se){return t.asArray(se).map(je).join("; ")+";";function je(Be){return Be+": "+se.getPropertyValue(Be)+(se.getPropertyPriority(Be)?" !important":"")}}}}}function z(){k instanceof HTMLTextAreaElement&&(N.innerHTML=k.value),k instanceof HTMLInputElement&&N.setAttribute("value",k.value)}function ie(){N instanceof SVGElement&&(N.setAttribute("xmlns","http://www.w3.org/2000/svg"),N instanceof SVGRectElement&&["width","height"].forEach(function(pe){var xe=N.getAttribute(pe);xe&&N.style.setProperty(pe,xe)}))}}}function U(C){return i.resolveAll().then(function(I){var D=document.createElement("style");return C.appendChild(D),D.appendChild(document.createTextNode(I)),C})}function $(C){return o.inlineAll(C).then(function(){return C})}function R(C,I,D){return Promise.resolve(C).then(function(A){return A.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(A)}).then(t.escapeXhtml).then(function(A){return'<foreignObject x="0" y="0" width="100%" height="100%">'+A+"</foreignObject>"}).then(function(A){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+I+'" height="'+D+'">'+A+"</svg>"}).then(function(A){return"data:image/svg+xml;charset=utf-8,"+A})}function p(){return{escape:ie,parseExtension:I,mimeType:D,dataAsUrl:z,isDataUrl:A,canvasToBlob:x,resolveUrl:k,getAndEncode:Z,uid:N(),delay:pe,asArray:xe,escapeXhtml:J,makeImage:O,width:Ie,height:ye};function C(){var T="application/font-woff",G="image/jpeg";return{woff:T,woff2:T,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:G,jpeg:G,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function I(T){var G=/\.([^\.\/]*?)$/g.exec(T);return G?G[1]:""}function D(T){var G=I(T).toLowerCase();return C()[G]||""}function A(T){return T.search(/^(data:)/)!==-1}function Y(T){return new Promise(function(G){for(var ee=window.atob(T.toDataURL().split(",")[1]),Q=ee.length,f=new Uint8Array(Q),w=0;w<Q;w++)f[w]=ee.charCodeAt(w);G(new Blob([f],{type:"image/png"}))})}function x(T){return T.toBlob?new Promise(function(G){T.toBlob(G)}):Y(T)}function k(T,G){var ee=document.implementation.createHTMLDocument(),Q=ee.createElement("base");ee.head.appendChild(Q);var f=ee.createElement("a");return ee.body.appendChild(f),Q.href=G,f.href=T,f.href}function N(){var T=0;return function(){return"u"+G()+T++;function G(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function O(T){return new Promise(function(G,ee){var Q=new Image;Q.onload=function(){G(Q)},Q.onerror=ee,Q.src=T})}function Z(T){var G=3e4;return l.impl.options.cacheBust&&(T+=(/\?/.test(T)?"&":"?")+new Date().getTime()),new Promise(function(ee){var Q=new XMLHttpRequest;Q.onreadystatechange=be,Q.ontimeout=_,Q.responseType="blob",Q.timeout=G,Q.open("GET",T,!0),Q.send();var f;if(l.impl.options.imagePlaceholder){var w=l.impl.options.imagePlaceholder.split(/,/);w&&w[1]&&(f=w[1])}function be(){if(Q.readyState===4){if(Q.status!==200){f?ee(f):se("cannot fetch resource: "+T+", status: "+Q.status);return}var je=new FileReader;je.onloadend=function(){var Be=je.result.split(/,/)[1];ee(Be)},je.readAsDataURL(Q.response)}}function _(){f?ee(f):se("timeout of "+G+"ms occured while fetching resource: "+T)}function se(je){console.error(je),ee("")}})}function z(T,G){return"data:"+G+";base64,"+T}function ie(T){return T.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function pe(T){return function(G){return new Promise(function(ee){setTimeout(function(){ee(G)},T)})}}function xe(T){for(var G=[],ee=T.length,Q=0;Q<ee;Q++)G.push(T[Q]);return G}function J(T){return T.replace(/#/g,"%23").replace(/\n/g,"%0A")}function Ie(T){var G=Ce(T,"border-left-width"),ee=Ce(T,"border-right-width");return T.scrollWidth+G+ee}function ye(T){var G=Ce(T,"border-top-width"),ee=Ce(T,"border-bottom-width");return T.scrollHeight+G+ee}function Ce(T,G){var ee=window.getComputedStyle(T).getPropertyValue(G);return parseFloat(ee.replace("px",""))}}function le(){var C=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:Y,shouldProcess:I,impl:{readUrls:D,inline:A}};function I(x){return x.search(C)!==-1}function D(x){for(var k=[],N;(N=C.exec(x))!==null;)k.push(N[1]);return k.filter(function(O){return!t.isDataUrl(O)})}function A(x,k,N,O){return Promise.resolve(k).then(function(z){return N?t.resolveUrl(z,N):z}).then(O||t.getAndEncode).then(function(z){return t.dataAsUrl(z,t.mimeType(k))}).then(function(z){return x.replace(Z(k),"$1"+z+"$3")});function Z(z){return new RegExp(`(url\\(['"]?)(`+t.escape(z)+`)(['"]?\\))`,"g")}}function Y(x,k,N){if(O())return Promise.resolve(x);return Promise.resolve(x).then(D).then(function(Z){var z=Promise.resolve(x);return Z.forEach(function(ie){z=z.then(function(pe){return A(pe,ie,k,N)})}),z});function O(){return!I(x)}}}function ke(){return{resolveAll:C,impl:{readAll:I}};function C(){return I().then(function(D){return Promise.all(D.map(function(A){return A.resolve()}))}).then(function(D){return D.join(`
`)})}function I(){return Promise.resolve(t.asArray(document.styleSheets)).then(A).then(D).then(function(x){return x.map(Y)});function D(x){return x.filter(function(k){return k.type===CSSRule.FONT_FACE_RULE}).filter(function(k){return r.shouldProcess(k.style.getPropertyValue("src"))})}function A(x){var k=[];return x.forEach(function(N){try{t.asArray(N.cssRules||[]).forEach(k.push.bind(k))}catch(O){console.log("Error while reading CSS rules from "+N.href,O.toString())}}),k}function Y(x){return{resolve:function(){var N=(x.parentStyleSheet||{}).href;return r.inlineAll(x.cssText,N)},src:function(){return x.style.getPropertyValue("src")}}}}}function ce(){return{inlineAll:I,impl:{newImage:C}};function C(D){return{inline:A};function A(Y){return t.isDataUrl(D.src)?Promise.resolve():Promise.resolve(D.src).then(Y||t.getAndEncode).then(function(x){return t.dataAsUrl(x,t.mimeType(D.src))}).then(function(x){return new Promise(function(k,N){D.onload=k,D.onerror=N,D.src=x})})}}function I(D){if(!(D instanceof Element))return Promise.resolve(D);return A(D).then(function(){return D instanceof HTMLImageElement?C(D).inline():Promise.all(t.asArray(D.childNodes).map(function(Y){return I(Y)}))});function A(Y){var x=Y.style.getPropertyValue("background");return x?r.inlineAll(x).then(function(k){Y.style.setProperty("background",k,Y.style.getPropertyPriority("background"))}).then(function(){return Y}):Promise.resolve(Y)}}}})()})(Mr);var ls=Mr.exports;const cs=ar(ls),Pt=({text:n,children:e})=>{const[t,r]=b.useState(!1),{darkMode:i}=Le();return s.jsxs("div",{className:"relative inline-block",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[e,t&&s.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 translate-y-1 px-2 py-1 text-xs rounded whitespace-nowrap z-50 mt-1
            ${i?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200"} shadow-lg`,children:[n,s.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent 
              ${i?"border-b-gray-800":"border-b-white"}`})]})]})},ds=({isOpen:n,onClose:e})=>{const{exifSettings:t,toggleExifSetting:r,toggleAllExifSettings:i,showZoomControls:o,toggleShowZoomControls:a,darkMode:l,showExifInfo:c,toggleShowExifInfo:h}=Le(),[d,g]=te.useState(n),[m,S]=te.useState(!1);if(te.useEffect(()=>{if(n){g(!0),S(!1);const p=requestAnimationFrame(()=>S(!0));return()=>cancelAnimationFrame(p)}else if(d){S(!1);const p=setTimeout(()=>g(!1),320);return()=>clearTimeout(p)}},[n]),!d)return null;const j={FileName:"",Resolution:"",Make:"",Model:"",LensModel:"",FocalLength:"",FNumber:"",ExposureTime:"",ISO:"ISO",DateTimeOriginal:""},X=["Make","Model","FocalLength","FNumber","ExposureTime","ISO"],U=["LensModel","FileName","Resolution","DateTimeOriginal"];Object.values(t).every(Boolean);const $=X.every(p=>t[p]),R=U.every(p=>t[p]);return yt.createPortal(s.jsxs("div",{className:`fixed right-8 top-20 min-w-[260px] max-w-[90vw] md:max-w-[400px] max-h-[80vh] overflow-y-auto rounded-3xl px-7 py-4 backdrop-blur-lg text-sm shadow-lg shadow-black/10 transition-all duration-300 scrollbar-hide pointer-events-auto select-none z-[2000] 
        ${l?"bg-gray-900/95 text-gray-100 border border-gray-700":"bg-white/80 text-gray-700 border border-gray-200"}`,style:{opacity:m?1:0,transform:m?"scale(1) translateY(0px)":"scale(0.95) translateY(40px)",transition:"opacity 0.32s cubic-bezier(.4,0,.2,1), transform 0.32s cubic-bezier(.4,0,.2,1)",pointerEvents:d?"auto":"none"},children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("h3",{className:"text-base font-semibold text-gray-800 dark:text-gray-100",children:""}),s.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100",children:s.jsx("span",{className:"text-lg",children:""})})]}),s.jsxs("div",{className:"flex items-center justify-between mt-1 mb-2",children:[s.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-100",children:"EXIF"}),s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer select-none",children:[s.jsx("input",{type:"checkbox",checked:c,onChange:h,className:"sr-only peer"}),s.jsx("div",{className:`w-11 h-6 bg-gray-300 dark:bg-gray-800 rounded-full peer-focus:ring-2 peer-focus:ring-sky-400 peer-focus:ring-opacity-50 transition-colors duration-200
            ${c?"bg-sky-500":l?"bg-gray-800":"bg-gray-300"}`,children:s.jsx("div",{className:`absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-white shadow-md transition-transform duration-200
              ${c?"translate-x-5":"translate-x-0"}`})})]})]}),c&&s.jsxs("div",{className:"flex flex-row gap-3 mb-2",children:[s.jsxs("div",{className:"flex-1 min-w-[120px]",children:[s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx("input",{type:"checkbox",checked:$,onChange:()=>{$?X.forEach(p=>{t[p]&&r(p)}):X.forEach(p=>{t[p]||r(p)})},className:"form-checkbox h-3.5 w-3.5 text-sky-500 rounded border-gray-300 focus:ring-sky-500 dark:border-gray-600 dark:bg-gray-700 dark:checked:bg-sky-500 mr-1"}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-300",children:""})]}),s.jsx("div",{className:"space-y-1",children:X.map(p=>s.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md transition-colors",children:[s.jsx("input",{type:"checkbox",checked:t[p],onChange:()=>r(p),className:"form-checkbox h-3.5 w-3.5 text-sky-500 rounded border-gray-300 focus:ring-sky-500 dark:border-gray-600 dark:bg-gray-700 dark:checked:bg-sky-500"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-100",children:j[p]||p})]},p))})]}),s.jsxs("div",{className:"flex-1 min-w-[120px]",children:[s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx("input",{type:"checkbox",checked:R,onChange:()=>{R?U.forEach(p=>{t[p]&&r(p)}):U.forEach(p=>{t[p]||r(p)})},className:"form-checkbox h-3.5 w-3.5 text-sky-500 rounded border-gray-300 focus:ring-sky-500 dark:border-gray-600 dark:bg-gray-700 dark:checked:bg-sky-500 mr-1"}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-300",children:""})]}),s.jsx("div",{className:"space-y-1",children:U.map(p=>s.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md transition-colors",children:[s.jsx("input",{type:"checkbox",checked:t[p],onChange:()=>r(p),className:"form-checkbox h-3.5 w-3.5 text-sky-500 rounded border-gray-300 focus:ring-sky-500 dark:border-gray-600 dark:bg-gray-700 dark:checked:bg-sky-500"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-100",children:j[p]||p})]},p))})]})]}),s.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-3"}),s.jsxs("div",{className:"flex items-center justify-between mt-1 mb-2",children:[s.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-100",children:""}),s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer select-none",children:[s.jsx("input",{type:"checkbox",checked:o,onChange:a,className:"sr-only peer"}),s.jsx("div",{className:`w-11 h-6 bg-gray-300 dark:bg-gray-800 rounded-full peer-focus:ring-2 peer-focus:ring-sky-400 peer-focus:ring-opacity-50 transition-colors duration-200
            ${o?"bg-sky-500":l?"bg-gray-800":"bg-gray-300"}`,children:s.jsx("div",{className:`absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-white shadow-md transition-transform duration-200
              ${o?"translate-x-5":"translate-x-0"}`})})]})]})]}),document.body)},us=()=>{const{darkMode:n,toggleDarkMode:e,demoMode:t,toggleDemoMode:r}=Le(),{images:i,addImages:o,clearImages:a}=dt(),[l,c]=b.useState(!1),h=b.useRef(null),[d,g]=b.useState(!1),m=async j=>{if(!j)return;const X=Array.from(j).filter($=>$.type.startsWith("image/"));if(X.length===0)return;a();const U=await Promise.all(X.map(an));o(U)},S=async()=>{var j,X;try{g(!0),document.body.classList.add("demo-mode-active"),await new Promise(C=>setTimeout(C,300));const U=document.querySelector("main");if(!U)throw new Error("");const $=await cs.toBlob(U,{quality:.95,bgcolor:n?"#000000":"#f9fafb",height:U.scrollHeight,width:U.scrollWidth,style:{transform:"none","transform-origin":"center",zoom:"1"}});let R="";if(i.length>0){const C=i[0],I=((j=C.exif)==null?void 0:j.Make)||"",D=((X=C.exif)==null?void 0:X.Model)||"";(I||D)&&(R+="_"+(I+D).trim().replace(/\s+/g,"-"))}const p=new Date,le=p.getFullYear()+("0"+(p.getMonth()+1)).slice(-2)+("0"+p.getDate()).slice(-2)+("0"+p.getHours()).slice(-2)+("0"+p.getMinutes()).slice(-2);R+="_"+le+".png";const ke=URL.createObjectURL($),ce=document.createElement("a");ce.href=ke,ce.download=R,ce.click(),URL.revokeObjectURL(ke),document.body.classList.remove("demo-mode-active"),g(!1)}catch(U){console.error(":",U),document.body.classList.remove("demo-mode-active"),g(!1),alert("")}};return i.length===0?null:s.jsxs("div",{className:"flex items-center space-x-4 setting-bar",children:[s.jsx("div",{className:"relative",children:s.jsx(Pt,{text:"",children:s.jsx("button",{onClick:S,disabled:d,className:`p-3 rounded-full backdrop-blur-md transition-all duration-200 border font-medium flex items-center
              ${n?"bg-gray-900 hover:bg-gray-800 text-white border-gray-700":"bg-sky-500/10 hover:bg-sky-500/20 text-gray-900 border-gray-200"}
              ${d?"opacity-50 cursor-not-allowed":""}`,children:s.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),s.jsx("circle",{cx:"12",cy:"13",r:"4"})]})})})}),s.jsxs("div",{className:"relative",children:[s.jsx(Pt,{text:"",children:s.jsx("button",{onClick:()=>c(!l),className:`p-3 rounded-full backdrop-blur-md transition-all duration-200 border font-medium flex items-center
              ${n?"bg-gray-900 hover:bg-gray-800 text-white border-gray-700":"bg-sky-500/10 hover:bg-sky-500/20 text-gray-900 border-gray-200"}`,children:s.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"3"}),s.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})}),s.jsx(ds,{isOpen:l,onClose:()=>c(!1)})]}),s.jsx(Pt,{text:"",children:s.jsx("button",{onClick:r,className:`p-3 rounded-full backdrop-blur-md transition-all duration-200 ${t?"bg-sky-600 hover:bg-sky-700 text-white":n?"bg-gray-900 hover:bg-gray-800 text-white":"bg-sky-500/10 hover:bg-sky-500/20 text-gray-900 dark:text-white"} font-medium desktop-only`,children:s.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})})})}),s.jsx("input",{ref:h,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:j=>m(j.target.files)}),s.jsx("button",{onClick:()=>{var j;return(j=h.current)==null?void 0:j.click()},className:`px-7 py-3 rounded-full backdrop-blur-md transition-all duration-200 ${n?"bg-sky-600 hover:bg-sky-700 text-white":"bg-sky-500 hover:bg-sky-600 text-white"} font-medium text-sm scale-105`,children:""}),s.jsxs("div",{className:"relative desktop-only",children:[s.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",id:"add-image-input",onChange:async j=>{if(j.target.files){const X=j.target.files,U=Array.from(X).filter(R=>R.type.startsWith("image/"));if(U.length===0)return;const $=await Promise.all(U.map(an));o($),j.target.value=""}}}),s.jsx(Pt,{text:"",children:s.jsx("button",{onClick:()=>{var j;return(j=document.getElementById("add-image-input"))==null?void 0:j.click()},className:`p-3 rounded-full backdrop-blur-md transition-all duration-200 ${n?"bg-gray-900 hover:bg-gray-800 text-white":"bg-sky-500/10 hover:bg-sky-500/20 text-gray-900"} font-medium`,children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})})]})]})};var Tr={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},nr=te.createContext&&te.createContext(Tr),Je=function(){return Je=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Je.apply(this,arguments)},hs=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};function Nr(n){return n&&n.map(function(e,t){return te.createElement(e.tag,Je({key:t},e.attr),Nr(e.child))})}function zt(n){return function(e){return te.createElement(fs,Je({attr:Je({},n.attr)},e),Nr(n.child))}}function fs(n){var e=function(t){var r=n.attr,i=n.size,o=n.title,a=hs(n,["attr","size","title"]),l=i||t.size||"1em",c;return t.className&&(c=t.className),n.className&&(c=(c?c+" ":"")+n.className),te.createElement("svg",Je({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,a,{className:c,style:Je(Je({color:n.color||t.color},t.style),n.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),o&&te.createElement("title",null,o),n.children)};return nr!==void 0?te.createElement(nr.Consumer,null,function(t){return e(t)}):e(Tr)}function gs(n){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"}}]})(n)}function ps(n){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"5 9 2 12 5 15"}},{tag:"polyline",attr:{points:"9 5 12 2 15 5"}},{tag:"polyline",attr:{points:"15 19 12 22 9 19"}},{tag:"polyline",attr:{points:"19 9 22 12 19 15"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"2",x2:"12",y2:"22"}}]})(n)}function ms(n){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"4 7 4 4 20 4 20 7"}},{tag:"line",attr:{x1:"9",y1:"20",x2:"15",y2:"20"}},{tag:"line",attr:{x1:"12",y1:"4",x2:"12",y2:"20"}}]})(n)}function xs(n){return zt({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"}},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"}}]})(n)}function Vt(){return(Vt=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n}).apply(this,arguments)}function Fr(n,e){if(n==null)return{};var t,r,i={},o=Object.keys(n);for(r=0;r<o.length;r++)e.indexOf(t=o[r])>=0||(i[t]=n[t]);return i}function ln(n){var e=b.useRef(n),t=b.useRef(function(r){e.current&&e.current(r)});return e.current=n,t.current}var St=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n<e?e:n},wt=function(n){return"touches"in n},cn=function(n){return n&&n.ownerDocument.defaultView||self},rr=function(n,e,t){var r=n.getBoundingClientRect(),i=wt(e)?function(o,a){for(var l=0;l<o.length;l++)if(o[l].identifier===a)return o[l];return o[0]}(e.touches,t):e;return{left:St((i.pageX-(r.left+cn(n).pageXOffset))/r.width),top:St((i.pageY-(r.top+cn(n).pageYOffset))/r.height)}},ir=function(n){!wt(n)&&n.preventDefault()},Dr=te.memo(function(n){var e=n.onMove,t=n.onKey,r=Fr(n,["onMove","onKey"]),i=b.useRef(null),o=ln(e),a=ln(t),l=b.useRef(null),c=b.useRef(!1),h=b.useMemo(function(){var S=function(U){ir(U),(wt(U)?U.touches.length>0:U.buttons>0)&&i.current?o(rr(i.current,U,l.current)):X(!1)},j=function(){return X(!1)};function X(U){var $=c.current,R=cn(i.current),p=U?R.addEventListener:R.removeEventListener;p($?"touchmove":"mousemove",S),p($?"touchend":"mouseup",j)}return[function(U){var $=U.nativeEvent,R=i.current;if(R&&(ir($),!function(le,ke){return ke&&!wt(le)}($,c.current)&&R)){if(wt($)){c.current=!0;var p=$.changedTouches||[];p.length&&(l.current=p[0].identifier)}R.focus(),o(rr(R,$,l.current)),X(!0)}},function(U){var $=U.which||U.keyCode;$<37||$>40||(U.preventDefault(),a({left:$===39?.05:$===37?-.05:0,top:$===40?.05:$===38?-.05:0}))},X]},[a,o]),d=h[0],g=h[1],m=h[2];return b.useEffect(function(){return m},[m]),te.createElement("div",Vt({},r,{onTouchStart:d,onMouseDown:d,className:"react-colorful__interactive",ref:i,onKeyDown:g,tabIndex:0,role:"slider"}))}),vn=function(n){return n.filter(Boolean).join(" ")},Lr=function(n){var e=n.color,t=n.left,r=n.top,i=r===void 0?.5:r,o=vn(["react-colorful__pointer",n.className]);return te.createElement("div",{className:o,style:{top:100*i+"%",left:100*t+"%"}},te.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},Se=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t},ys=function(n){return ks(dn(n))},dn=function(n){return n[0]==="#"&&(n=n.substring(1)),n.length<6?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?Se(parseInt(n[3]+n[3],16)/255,2):1}:{r:parseInt(n.substring(0,2),16),g:parseInt(n.substring(2,4),16),b:parseInt(n.substring(4,6),16),a:n.length===8?Se(parseInt(n.substring(6,8),16)/255,2):1}},bs=function(n){return Ss(vs(n))},ws=function(n){var e=n.s,t=n.v,r=n.a,i=(200-e)*t/100;return{h:Se(n.h),s:Se(i>0&&i<200?e*t/100/(i<=100?i:200-i)*100:0),l:Se(i/2),a:Se(r,2)}},un=function(n){var e=ws(n);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},vs=function(n){var e=n.h,t=n.s,r=n.v,i=n.a;e=e/360*6,t/=100,r/=100;var o=Math.floor(e),a=r*(1-t),l=r*(1-(e-o)*t),c=r*(1-(1-e+o)*t),h=o%6;return{r:Se(255*[r,l,a,a,c,r][h]),g:Se(255*[c,r,r,l,a,a][h]),b:Se(255*[a,a,c,r,r,l][h]),a:Se(i,2)}},It=function(n){var e=n.toString(16);return e.length<2?"0"+e:e},Ss=function(n){var e=n.r,t=n.g,r=n.b,i=n.a,o=i<1?It(Se(255*i)):"";return"#"+It(e)+It(t)+It(r)+o},ks=function(n){var e=n.r,t=n.g,r=n.b,i=n.a,o=Math.max(e,t,r),a=o-Math.min(e,t,r),l=a?o===e?(t-r)/a:o===t?2+(r-e)/a:4+(e-t)/a:0;return{h:Se(60*(l<0?l+6:l)),s:Se(o?a/o*100:0),v:Se(o/255*100),a:i}},Cs=te.memo(function(n){var e=n.hue,t=n.onChange,r=vn(["react-colorful__hue",n.className]);return te.createElement("div",{className:r},te.createElement(Dr,{onMove:function(i){t({h:360*i.left})},onKey:function(i){t({h:St(e+360*i.left,0,360)})},"aria-label":"Hue","aria-valuenow":Se(e),"aria-valuemax":"360","aria-valuemin":"0"},te.createElement(Lr,{className:"react-colorful__hue-pointer",left:e/360,color:un({h:e,s:100,v:100,a:1})})))}),js=te.memo(function(n){var e=n.hsva,t=n.onChange,r={backgroundColor:un({h:e.h,s:100,v:100,a:1})};return te.createElement("div",{className:"react-colorful__saturation",style:r},te.createElement(Dr,{onMove:function(i){t({s:100*i.left,v:100-100*i.top})},onKey:function(i){t({s:St(e.s+100*i.left,0,100),v:St(e.v-100*i.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Se(e.s)+"%, Brightness "+Se(e.v)+"%"},te.createElement(Lr,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:un(e)})))}),Rr=function(n,e){if(n===e)return!0;for(var t in n)if(n[t]!==e[t])return!1;return!0},Ps=function(n,e){return n.toLowerCase()===e.toLowerCase()||Rr(dn(n),dn(e))};function Is(n,e,t){var r=ln(t),i=b.useState(function(){return n.toHsva(e)}),o=i[0],a=i[1],l=b.useRef({color:e,hsva:o});b.useEffect(function(){if(!n.equal(e,l.current.color)){var h=n.toHsva(e);l.current={hsva:h,color:e},a(h)}},[e,n]),b.useEffect(function(){var h;Rr(o,l.current.hsva)||n.equal(h=n.fromHsva(o),l.current.color)||(l.current={hsva:o,color:h},r(h))},[o,n,r]);var c=b.useCallback(function(h){a(function(d){return Object.assign({},d,h)})},[]);return[o,c]}var Es=typeof window<"u"?b.useLayoutEffect:b.useEffect,As=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},sr=new Map,Ms=function(n){Es(function(){var e=n.current?n.current.ownerDocument:document;if(e!==void 0&&!sr.has(e)){var t=e.createElement("style");t.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,sr.set(e,t);var r=As();r&&t.setAttribute("nonce",r),e.head.appendChild(t)}},[])},Ts=function(n){var e=n.className,t=n.colorModel,r=n.color,i=r===void 0?t.defaultColor:r,o=n.onChange,a=Fr(n,["className","colorModel","color","onChange"]),l=b.useRef(null);Ms(l);var c=Is(t,i,o),h=c[0],d=c[1],g=vn(["react-colorful",e]);return te.createElement("div",Vt({},a,{ref:l,className:g}),te.createElement(js,{hsva:h,onChange:d}),te.createElement(Cs,{hue:h.h,onChange:d,className:"react-colorful__last-control"}))},Ns={defaultColor:"000",toHsva:ys,fromHsva:function(n){return bs({h:n.h,s:n.s,v:n.v,a:1})},equal:Ps},Fs=function(n){return te.createElement(Ts,Vt({},n,{colorModel:Ns}))};const Et=["#FF3B30","#FFD60A","#007AFF"],Ds=[2,4,8],Ls=72,Rs=999,Os=[14,18,24],Us=[{type:"move",icon:s.jsx(ps,{size:22,style:{display:"block"}}),label:"/"},{type:"rect",icon:s.jsx("svg",{width:"22",height:"22",viewBox:"0 0 22 22",style:{display:"block"},children:s.jsx("rect",{x:"4",y:"4",width:"14",height:"14",rx:"4",stroke:"currentColor",strokeWidth:"2.2",fill:"none"})}),label:""},{type:"ellipse",icon:s.jsx("svg",{width:"22",height:"22",viewBox:"0 0 22 22",style:{display:"block"},children:s.jsx("ellipse",{cx:"11",cy:"11",rx:"7",ry:"7",stroke:"currentColor",strokeWidth:"2.2",fill:"none"})}),label:""},{type:"pen",icon:s.jsx(gs,{size:22,style:{display:"block"}}),label:""},{type:"text",icon:s.jsx(ms,{size:22,style:{display:"block"}}),label:""}];function or(n=28,e=16,t=1,r=1.35){const i=e/2;let o="";for(let a=0;a<=n;a++){const l=a,c=i+r*Math.sin(a/n*t*2*Math.PI);o+=a===0?`M${l},${c}`:` L${l},${c}`}return o}const mt=({text:n,children:e})=>{const[t,r]=b.useState(!1),{darkMode:i}=Le();return s.jsxs("div",{className:"relative inline-block",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[e,t&&s.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 translate-y-1 px-2 py-1 text-xs rounded whitespace-nowrap z-50 mt-1
            ${i?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200"} shadow-lg`,children:[n,s.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent
              ${i?"border-b-gray-800":"border-b-white"}`})]})]})},Bs=()=>{const{annotationTool:n,setAnnotationTool:e,annotationStrokeWidth:t,setStrokeWidth:r,annotationColor:i,setAnnotationColor:o,annotationToolbar:a,clearAnnotations:l,isAnnotateMode:c,annotations:h,annotationFontSize:d,setAnnotationFontSize:g}=me(),[m,S]=b.useState(!1),[j,X]=b.useState("#FF3B30"),U=b.useRef(null),$=b.useRef(null),[R,p]=b.useState(!1),[le,ke]=b.useState(!1),[ce,C]=b.useState({x:0,y:0}),I=b.useRef({x:0,y:0});b.useRef(null);const[D,A]=b.useState({left:0,top:0}),[Y,x]=b.useState(!1),k=b.useRef(null),[N,O]=b.useState({left:0,top:0}),[Z,z]=b.useState(!1),ie=b.useRef(null),[pe,xe]=b.useState({left:0,top:0}),{darkMode:J}=Le();te.useEffect(()=>{a.visible?(p(!0),setTimeout(()=>{if(U.current){const f=U.current.getBoundingClientRect();C({x:(window.innerWidth-f.width)/2,y:window.innerHeight*.7})}ke(!0)},10),o("#FF3B30"),X("#FF3B30"),r(4)):R&&ke(!1)},[a.visible]),b.useLayoutEffect(()=>{if(!le&&R){const f=setTimeout(()=>p(!1),350);return()=>clearTimeout(f)}},[le,R]);const Ie=f=>{if(f.target.closest(".toolbar-btn")||f.button!==0||!U.current)return;const w=U.current.getBoundingClientRect();I.current={x:f.clientX-w.left,y:f.clientY-w.top},window.addEventListener("pointermove",ye),window.addEventListener("pointerup",Ce)},ye=f=>{C({x:f.clientX-I.current.x,y:f.clientY-I.current.y})},Ce=()=>{window.removeEventListener("pointermove",ye),window.removeEventListener("pointerup",Ce)},T={position:"fixed",left:ce.x,top:ce.y,zIndex:1e3,width:"fit-content",height:Ls,borderRadius:Rs,background:J?"rgba(24, 26, 32, 0.92)":"rgba(255,255,255,0.92)",backdropFilter:"blur(16px) saturate(1.5)",boxShadow:J?"0 8px 32px rgba(0,0,0,0.38)":"0 8px 32px rgba(0,0,0,0.18)",border:J?"1.5px solid rgba(80,80,100,0.18)":"1.5px solid rgba(180,180,200,0.13)",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:0,userSelect:"none",WebkitUserSelect:"none",touchAction:"none",opacity:le?1:0,pointerEvents:R?"auto":"none",transform:le?"scale(1) translateY(0px)":"scale(0.95) translateY(40px)",transition:"opacity 0.35s cubic-bezier(.4,0,.2,1), transform 0.35s cubic-bezier(.4,0,.2,1)",padding:"0 36px",boxSizing:"border-box",color:J?"#e5e7eb":"#333"};te.useEffect(()=>{if(m&&$.current){const f=$.current.getBoundingClientRect(),w=220,be=170,_=100;let se=f.left+f.width/2-w/2,je=f.top-be-_;je<_&&(je=f.bottom+_),se<8&&(se=8),se+w>window.innerWidth-8&&(se=window.innerWidth-w-8),A({left:se,top:je})}},[m,ce]),te.useEffect(()=>{if(!m)return;const f=w=>{!w.target.closest(".color-popover")&&!w.target.closest(".toolbar-btn")&&S(!1)};return window.addEventListener("mousedown",f),()=>window.removeEventListener("mousedown",f)},[m]);const G={border:"none",borderRadius:"50%",width:40,height:40,minWidth:40,minHeight:40,maxWidth:40,maxHeight:40,display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,transition:"box-shadow 0.18s, background 0.18s",padding:0,overflow:"hidden",background:"transparent"};if(te.useEffect(()=>{if(Y&&k.current){const f=k.current.getBoundingClientRect(),w=48,be=140;let _=f.left+f.width/2-w/2,se=f.top-be-12;se<8&&(se=f.bottom+12),_<8&&(_=8),_+w>window.innerWidth-8&&(_=window.innerWidth-w-8),O({left:_,top:se})}if(Y){const f=w=>{const be=document.querySelector(".stroke-menu-popover");be&&!be.contains(w.target)&&k.current&&!k.current.contains(w.target)&&x(!1)};return window.addEventListener("mousedown",f),()=>window.removeEventListener("mousedown",f)}},[Y,ce]),te.useEffect(()=>{if(Z&&ie.current){const f=ie.current.getBoundingClientRect(),w=48,be=140;let _=f.left+f.width/2-w/2,se=f.top-be-12;se<8&&(se=f.bottom+12),_<8&&(_=8),_+w>window.innerWidth-8&&(_=window.innerWidth-w-8),xe({left:_,top:se})}if(Z){const f=w=>{const be=document.querySelector(".font-menu-popover");be&&!be.contains(w.target)&&ie.current&&!ie.current.contains(w.target)&&z(!1)};return window.addEventListener("mousedown",f),()=>window.removeEventListener("mousedown",f)}},[Z,ce]),!R)return null;const ee=m?yt.createPortal(s.jsxs("div",{className:"color-popover",onPointerDown:f=>f.stopPropagation(),style:{position:"fixed",zIndex:3e3,left:D.left,top:D.top,width:220,background:"rgba(255,255,255,0.98)",borderRadius:18,boxShadow:"0 4px 24px rgba(0,0,0,0.13)",padding:18,display:"flex",flexDirection:"column",alignItems:"center",gap:12,border:"1.5px solid #e0e0e0",opacity:1,pointerEvents:"auto"},onClick:f=>f.stopPropagation(),children:[s.jsx(Fs,{color:j,onChange:f=>{X(f),o(f)},style:{width:180,height:120}}),s.jsx("input",{type:"text",value:j,onChange:f=>{X(f.target.value),o(f.target.value)},style:{width:90,fontSize:15,border:"1px solid #eee",borderRadius:8,padding:"3px 8px",textAlign:"center",marginTop:4},maxLength:9}),s.jsx("button",{style:{marginTop:8,fontSize:13,color:"#888",background:"none",border:"none",cursor:"pointer"},onClick:()=>S(!1),children:""})]}),document.body):null,Q=Z?yt.createPortal(s.jsx("div",{className:"font-menu-popover",onPointerDown:f=>f.stopPropagation(),style:{position:"fixed",zIndex:3e3,left:pe.left,top:pe.top,width:48,background:"rgba(255,255,255,0.98)",borderRadius:25,boxShadow:"0 4px 24px rgba(0,0,0,0.13)",padding:10,display:"flex",flexDirection:"column",alignItems:"center",gap:12,border:"1.5px solid #e0e0e0",opacity:1,pointerEvents:"auto"},children:Os.map(f=>s.jsx("button",{onClick:()=>{g(f),z(!1)},style:{width:32,height:32,borderRadius:"50%",border:"none",background:d===f?"#e6f0ff":"transparent",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"none",margin:0,padding:0,cursor:"pointer",fontSize:f,color:d===f?"#007AFF":"#333"},title:`${f}`,onMouseEnter:w=>w.currentTarget.style.boxShadow="0 0 0 3px #007AFF66",onMouseLeave:w=>w.currentTarget.style.boxShadow=d===f?"0 0 0 3px #007AFF66":"none",onFocus:w=>w.currentTarget.style.boxShadow="0 0 0 3px #007AFF66",onBlur:w=>w.currentTarget.style.boxShadow=d===f?"0 0 0 3px #007AFF66":"none",children:"T"},f))}),document.body):null;return s.jsxs("div",{ref:U,style:T,className:"annotation-toolbar",onPointerDown:Ie,children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[s.jsx("div",{style:{display:"flex",gap:12},children:Us.map(f=>s.jsx(mt,{text:f.label,children:s.jsx("button",{className:"toolbar-btn",ref:f.type==="text"?ie:void 0,onClick:()=>{e(f.type),f.type==="text"?z(w=>!w):z(!1)},style:{...G,background:n===f.type?"#e6f0ff":"transparent",color:n===f.type?J?"#60a5fa":"#007AFF":J?"#e5e7eb":"#333",boxShadow:n===f.type?"0 0 0 3px #007AFF66":void 0},onMouseEnter:w=>w.currentTarget.style.boxShadow=n===f.type?"0 0 0 3px #007AFF66":"0 0 0 3px #007AFF33",onMouseLeave:w=>w.currentTarget.style.boxShadow=n===f.type?"0 0 0 3px #007AFF66":"none",onFocus:w=>w.currentTarget.style.boxShadow=n===f.type?"0 0 0 3px #007AFF66":"0 0 0 3px #007AFF33",onBlur:w=>w.currentTarget.style.boxShadow=n===f.type?"0 0 0 3px #007AFF66":"none",children:s.jsx("span",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:f.icon})})},f.type))}),s.jsx("div",{className:"annotation-toolbar-divider",style:{height:36,width:1.5,background:J?"rgba(120,120,140,0.28)":"rgba(120,120,140,0.18)",margin:"0 16px"}}),s.jsxs("div",{style:{display:"flex",gap:12},children:[s.jsx(mt,{text:"",children:s.jsx("button",{ref:k,className:"toolbar-btn",onClick:()=>x(f=>!f),style:{...G,background:"transparent",boxShadow:Y?"0 0 0 3px #007AFF66":"none",outline:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:0,overflow:"hidden",color:J?"#e5e7eb":"#333"},onMouseEnter:f=>{const w=f.currentTarget.querySelector("path");w&&w.setAttribute("stroke",t?J?"#60a5fa":"#007AFF":J?"#e5e7eb":"#333")},onMouseLeave:f=>{const w=f.currentTarget.querySelector("path");w&&w.setAttribute("stroke",t?J?"#60a5fa":"#007AFF":J?"#e5e7eb":"#333")},onFocus:f=>{const w=f.currentTarget.querySelector("path");w&&w.setAttribute("stroke",t?J?"#60a5fa":"#007AFF":J?"#e5e7eb":"#333")},onBlur:f=>{const w=f.currentTarget.querySelector("path");w&&w.setAttribute("stroke",t?J?"#60a5fa":"#007AFF":J?"#e5e7eb":"#333")},children:s.jsx("span",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("svg",{width:"28",height:t+16,viewBox:`0 0 28 ${t+16}`,style:{display:"block"},children:s.jsx("path",{d:or(28,t+16,1,1.35),stroke:J?"#e5e7eb":"#333",strokeWidth:t,fill:"none",strokeLinecap:"round"})})})})}),Y&&yt.createPortal(s.jsx("div",{className:"stroke-menu-popover",onPointerDown:f=>f.stopPropagation(),style:{position:"fixed",zIndex:3e3,left:N.left,top:N.top,width:48,background:J?"rgba(24, 26, 32, 0.98)":"rgba(255,255,255,0.98)",borderRadius:25,boxShadow:J?"0 4px 24px rgba(0,0,0,0.38)":"0 4px 24px rgba(0,0,0,0.13)",padding:10,display:"flex",flexDirection:"column",alignItems:"center",gap:12,border:J?"1.5px solid rgba(80,80,100,0.18)":"1.5px solid #e0e0e0",opacity:1,pointerEvents:"auto"},children:Ds.map(f=>s.jsx("button",{onClick:()=>{r(f),x(!1)},style:{width:32,height:32,borderRadius:"50%",border:"none",background:t===f?"#e6f0ff":"transparent",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"none",margin:0,padding:0,cursor:"pointer"},title:`${f}`,onMouseEnter:w=>w.currentTarget.style.boxShadow="0 0 0 3px #007AFF66",onMouseLeave:w=>w.currentTarget.style.boxShadow=t===f?"0 0 0 3px #007AFF66":"none",onFocus:w=>w.currentTarget.style.boxShadow="0 0 0 3px #007AFF66",onBlur:w=>w.currentTarget.style.boxShadow=t===f?"0 0 0 3px #007AFF66":"none",children:s.jsx("svg",{width:"28",height:f+16,viewBox:`0 0 28 ${f+16}`,style:{display:"block"},children:s.jsx("path",{d:or(28,f+16,1,1.35),stroke:t===f?J?"#60a5fa":"#007AFF":J?"#e5e7eb":"#333",strokeWidth:f,fill:"none",strokeLinecap:"round"})})},f))}),document.body)]}),s.jsx("div",{className:"annotation-toolbar-divider",style:{height:36,width:1.5,background:J?"rgba(120,120,140,0.28)":"rgba(120,120,140,0.18)",margin:"0 16px"}}),s.jsxs("div",{style:{display:"flex",gap:12},children:[Et.map(f=>s.jsx(mt,{text:f,children:s.jsx("button",{className:"toolbar-btn",onClick:()=>o(f),style:{...G,background:J?"#23272f":"#fff",boxShadow:i===f?"0 0 0 3px #007AFF66":void 0,border:"none",outline:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:0,overflow:"hidden"},onMouseEnter:w=>w.currentTarget.style.boxShadow=i===f?"0 0 0 3px #007AFF66":"0 0 0 3px #007AFF33",onMouseLeave:w=>w.currentTarget.style.boxShadow=i===f?"0 0 0 3px #007AFF66":"none",onFocus:w=>w.currentTarget.style.boxShadow=i===f?"0 0 0 3px #007AFF66":"0 0 0 3px #007AFF33",onBlur:w=>w.currentTarget.style.boxShadow=i===f?"0 0 0 3px #007AFF66":"none",children:s.jsx("span",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("span",{style:{display:"block",width:25,height:25,borderRadius:"50%",background:f}})})})},f)),s.jsx(mt,{text:"",children:s.jsx("button",{ref:$,className:"toolbar-btn",style:{...G,background:J?"#23272f":"#fff",boxShadow:!Et.includes(i)&&j===i||m?"0 0 0 3px #007AFF66":"none",outline:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:0,overflow:"hidden"},onClick:()=>S(f=>!f),onMouseEnter:f=>f.currentTarget.style.boxShadow="0 0 0 3px #007AFF66",onMouseLeave:f=>f.currentTarget.style.boxShadow=!Et.includes(i)&&j===i||m?"0 0 0 3px #007AFF66":"none",onFocus:f=>f.currentTarget.style.boxShadow="0 0 0 3px #007AFF66",onBlur:f=>f.currentTarget.style.boxShadow=!Et.includes(i)&&j===i||m?"0 0 0 3px #007AFF66":"none",children:s.jsxs("span",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[s.jsxs("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{display:"block",margin:"auto"},children:[s.jsx("circle",{cx:"15",cy:"15",r:"13",stroke:"#bbb",strokeWidth:"3",fill:"none"}),s.jsx("path",{d:"M15 2 A13 13 0 0 1 28 15",stroke:"#FF3B30",strokeWidth:"4",fill:"none"}),s.jsx("path",{d:"M28 15 A13 13 0 0 1 15 28",stroke:"#FFD60A",strokeWidth:"4",fill:"none"}),s.jsx("path",{d:"M15 28 A13 13 0 0 1 2 15",stroke:"#007AFF",strokeWidth:"4",fill:"none"}),s.jsx("path",{d:"M2 15 A13 13 0 0 1 15 2",stroke:"#34C759",strokeWidth:"4",fill:"none"})]}),s.jsx("span",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",width:20,height:20,borderRadius:"50%",background:j,border:"1.5px solid #eee",boxShadow:"0 0 2px #007AFF44",display:"flex",alignItems:"center",justifyContent:"center"}})]})})})]}),s.jsx("div",{className:"annotation-toolbar-divider",style:{height:36,width:1.5,background:J?"rgba(120,120,140,0.28)":"rgba(120,120,140,0.18)",margin:"0 16px"}}),s.jsx("div",{style:{display:"flex",gap:0},children:s.jsx(mt,{text:"",children:s.jsx("button",{className:"toolbar-btn",onClick:()=>{Object.keys(h).forEach(f=>l(f))},style:{...G,background:J?"#23272f":"#fff",color:"#FF3B30",boxShadow:"none"},onMouseEnter:f=>f.currentTarget.style.boxShadow="0 0 0 3px #FF3B3066",onMouseLeave:f=>f.currentTarget.style.boxShadow="none",onFocus:f=>f.currentTarget.style.boxShadow="0 0 0 3px #FF3B3066",onBlur:f=>f.currentTarget.style.boxShadow="none",children:s.jsx("span",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(xs,{size:22,style:{display:"block",margin:"auto"}})})})})})]}),ee,Q]})},$s=({isOpen:n,onClose:e,darkMode:t,toggleDarkMode:r,syncZoom:i,toggleSyncZoom:o,images:a})=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`sidebar-backdrop ${n?"open":""}`,onClick:e}),s.jsxs("div",{className:`mobile-sidebar ${n?"open":""}`,children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:`text-xl font-semibold ${t?"text-white":"text-gray-900"}`,children:"PhotoCompare"}),s.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",children:s.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"p-3 rounded-lg bg-gray-100 dark:bg-gray-800",children:[a.length>0&&s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:`${t?"text-gray-300":"text-gray-700"}`,children:""}),s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",checked:i,onChange:o,className:"sr-only peer"}),s.jsx("div",{className:`relative w-11 h-6 rounded-full transition-all duration-200 
                    ${i?"bg-sky-500":t?"bg-gray-700":"bg-gray-300"} 
                    cursor-pointer
                    after:content-[''] after:absolute after:top-0.5 after:left-0.5 
                    after:bg-white after:rounded-full after:h-5 after:w-5 
                    after:shadow-md after:transition-all
                    ${i?"after:translate-x-5":"after:translate-x-0"}`})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:`${t?"text-gray-300":"text-gray-700"}`,children:t?"":""}),s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",checked:t,onChange:r,className:"sr-only peer"}),s.jsx("div",{className:`relative w-11 h-6 rounded-full transition-all duration-200 
                  ${t?"bg-sky-500":"bg-gray-300"} 
                  cursor-pointer
                  after:content-[''] after:absolute after:top-0.5 after:left-0.5 
                  after:bg-white after:rounded-full after:h-5 after:w-5 
                  after:shadow-md after:transition-all
                  ${t?"after:translate-x-5":"after:translate-x-0"}`})]})]})]}),s.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 text-sm text-gray-500 dark:text-gray-400",children:[s.jsxs("div",{className:"mb-2",children:[" ",new Date().getFullYear()," Jim"]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("a",{href:"https://space.bilibili.com/13818699",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-1 text-sky-500",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906L17.813 4.653zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773H5.333zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"})}),s.jsx("span",{children:"@Jim"})]}),s.jsx("span",{children:""}),s.jsx("span",{className:"text-sm opacity-60",children:"v1.1.1"})]})]})]})]})]}),Ws=()=>{const{darkMode:n,toggleDarkMode:e,demoMode:t,toggleDemoMode:r,syncZoom:i,toggleSyncZoom:o}=Le(),{images:a}=dt(),[l,c]=b.useState(!1),[h,d]=b.useState(!1),[g,m]=b.useState(!1),[S,j]=b.useState(!1),{isAnnotateMode:X,setAnnotateMode:U,setToolbarVisible:$}=me();return b.useEffect(()=>{n?(document.documentElement.classList.add("dark"),document.documentElement.classList.add("dark-mode")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.remove("dark-mode"))},[n]),b.useEffect(()=>{const R=()=>{!document.fullscreenElement&&t&&r()};return document.addEventListener("fullscreenchange",R),()=>{document.removeEventListener("fullscreenchange",R)}},[t,r]),b.useEffect(()=>{if(t){document.body.classList.add("demo-mode-active"),document.documentElement.requestFullscreen().catch(()=>{r()}),c(!0);const R=setTimeout(()=>{c(!1)},3e3);return()=>{clearTimeout(R),document.body.classList.remove("demo-mode-active")}}else document.body.classList.remove("demo-mode-active"),c(!1),document.fullscreenElement&&document.exitFullscreen().catch(()=>{console.error("")})},[t,r]),b.useEffect(()=>{$(X)},[X,$]),s.jsx("div",{className:`h-screen overflow-hidden ${n?"bg-black":"bg-gray-50"}`,children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"fixed top-0 left-0 right-0 h-16 z-50 px-6 flex items-center justify-between backdrop-blur-md bg-white/5 dark:bg-black/50 app-header",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("button",{className:"menu-button mr-2 p-2 rounded-full hover:bg-gray-200/50 dark:hover:bg-gray-800/50 hidden",onClick:()=>j(!0),children:s.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:n?"white":"black",strokeWidth:"2",children:s.jsx("path",{d:"M4 6h16M4 12h16M4 18h16",strokeLinecap:"round",strokeLinejoin:"round"})})}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("h1",{className:`text-xl font-semibold ${n?"text-gray-100":"text-gray-900"}`,children:"PhotoCompare"}),s.jsx("button",{onClick:()=>m(!0),className:`ml-2 w-6 h-6 rounded-full flex items-center justify-center ${n?"bg-gray-800 text-gray-300 hover:bg-gray-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"} transition-colors`,title:"",children:s.jsx("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M12 2a10 10 0 110 20 10 10 0 010-20z"})})})]}),s.jsxs("div",{className:`px-4 py-1.5 rounded-full backdrop-blur-md transition-all duration-200 ${n?"bg-gray-900 text-white":"bg-sky-500/10 text-gray-900"} flex items-center desktop-only`,children:[s.jsx("span",{className:"text-sm font-medium mr-3",children:n?"":""}),s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",checked:n,onChange:e,className:"sr-only peer"}),s.jsx("div",{className:`relative w-14 h-7 rounded-full transition-all duration-200 
                  ${n?"bg-sky-500":"bg-gray-300"} 
                  cursor-pointer
                  after:content-[''] after:absolute after:top-1 after:left-1 
                  after:bg-white after:rounded-full after:h-5 after:w-5 
                  after:shadow-md after:transition-all
                  ${n?"after:translate-x-7":"after:translate-x-0"}
                  peer-focus:ring-2 peer-focus:ring-sky-400 peer-focus:ring-opacity-50`,children:s.jsx("span",{className:"sr-only",children:""})})]})]}),a.length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`px-4 py-1.5 rounded-full backdrop-blur-md transition-all duration-200 ${n?"bg-gray-900 text-white":"bg-sky-500/10 text-gray-900"} flex items-center desktop-only`,children:[s.jsx("span",{className:"text-sm font-medium mr-3",children:""}),s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",checked:i,onChange:o,className:"sr-only peer"}),s.jsx("div",{className:`relative w-14 h-7 rounded-full transition-all duration-200 
                      ${i?"bg-sky-500":n?"bg-gray-800":"bg-gray-300"} 
                      cursor-pointer
                      after:content-[''] after:absolute after:top-1 after:left-1 
                      after:bg-white after:rounded-full after:h-5 after:w-5 
                      after:shadow-md after:transition-all
                      ${i?"after:translate-x-7":"after:translate-x-0"}
                      peer-focus:ring-2 peer-focus:ring-sky-400 peer-focus:ring-opacity-50`,children:s.jsx("span",{className:"sr-only",children:""})})]})]}),s.jsxs("div",{className:`px-4 py-1.5 rounded-full backdrop-blur-md transition-all duration-200 ml-2 ${X?"bg-sky-600 text-white":n?"bg-gray-900 text-white":"bg-sky-500/10 text-gray-900"} flex items-center desktop-only`,children:[s.jsx("span",{className:"text-sm font-medium mr-3",children:""}),s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",checked:X,onChange:R=>U(R.target.checked),className:"sr-only peer"}),s.jsx("div",{className:`relative w-14 h-7 rounded-full transition-all duration-200 
                      ${X?"bg-sky-500":n?"bg-gray-800":"bg-gray-300"} 
                      cursor-pointer
                      after:content-[''] after:absolute after:top-1 after:left-1 
                      after:bg-white after:rounded-full after:h-5 after:w-5 
                      after:shadow-md after:transition-all
                      ${X?"after:translate-x-7":"after:translate-x-0"}
                      peer-focus:ring-2 peer-focus:ring-sky-400 peer-focus:ring-opacity-50`,children:s.jsx("span",{className:"sr-only",children:""})})]})]})]})]}),s.jsx(us,{})]}),s.jsxs("main",{className:"h-full pt-16",children:[a.length===0&&!dt.getState().hasViewedImages?s.jsx(os,{}):s.jsx(as,{images:a}),s.jsx(Bs,{})]}),s.jsx("footer",{className:"fixed bottom-0 left-0 right-0 p-6 backdrop-blur-md bg-white/5 dark:bg-black app-footer",children:s.jsxs("div",{className:`max-w-screen-xl mx-auto flex items-center justify-between ${n?"text-white/60":"text-gray-600"}`,children:[s.jsxs("div",{className:"flex items-center space-x-2 group",children:[s.jsx("span",{className:"text-sm transition-all duration-300 group-hover:text-sky-500",children:"Created by Jim"}),s.jsx("span",{className:"text-sm opacity-60",children:""}),s.jsxs("a",{href:"https://space.bilibili.com/13818699",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-1.5 text-sm transition-all duration-300 hover:text-sky-500",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906L17.813 4.653zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773H5.333zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"})}),s.jsx("span",{children:"@Jim"})]}),s.jsx("span",{className:"text-sm opacity-60",children:""}),s.jsxs("span",{className:"text-sm opacity-60",children:[" ",new Date().getFullYear()]}),s.jsx("span",{className:"text-sm opacity-60",children:""}),s.jsx("span",{className:"text-sm opacity-60",children:"v1.1.1"}),s.jsx("span",{className:"text-sm opacity-60",children:""}),s.jsx("button",{className:"text-sm text-sky-500 hover:underline focus:outline-none focus:underline ml-2",onClick:()=>d(!0),style:{background:"none",border:"none",padding:0,cursor:"pointer"},children:""})]}),s.jsx("div",{className:"text-sm opacity-60",children:"Made with  in China"})]})}),h&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:()=>d(!1),children:s.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl p-8 flex flex-col items-center relative",onClick:R=>R.stopPropagation(),children:[s.jsx("span",{className:"absolute top-2 right-3 text-2xl text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 cursor-pointer",onClick:()=>d(!1),children:""}),s.jsx("div",{className:"w-48 h-48 mb-4 flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:s.jsx("img",{src:"/photoCompare/placeholder-qrcode.jpeg",alt:"",className:"max-w-full max-h-full object-contain"})}),s.jsx("div",{className:"text-base font-medium text-gray-700 dark:text-gray-200",children:""})]})}),g&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:()=>m(!1),children:s.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl p-8 max-w-md w-full flex flex-col relative",onClick:R=>R.stopPropagation(),children:[s.jsx("span",{className:"absolute top-2 right-3 text-2xl text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 cursor-pointer",onClick:()=>m(!1),children:""}),s.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-4",children:" PhotoCompare"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-md font-semibold text-gray-700 dark:text-gray-300 mb-2",children:""}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:": v1.1.1"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-md font-semibold text-gray-700 dark:text-gray-300 mb-2",children:""}),s.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-disc pl-5",children:[s.jsx("li",{children:""}),s.jsx("li",{children:"(EXIF)"}),s.jsx("li",{children:""}),s.jsx("li",{children:"/"})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-md font-semibold text-gray-700 dark:text-gray-300 mb-2",children:""}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("a",{href:"https://github.com/jimmcheung/photoCompare",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-2 text-sm text-sky-600 dark:text-sky-400 hover:underline",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"})}),s.jsx("span",{children:"GitHub "})]}),s.jsxs("a",{href:"/heic-test.html",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-2 text-sm text-sky-600 dark:text-sky-400 hover:underline",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M5 8.5c0-1.5 1-2.5 2.5-2.5H9c1.5 0 2.5 1 2.5 2.5v7c0 1.5-1 2.5-2.5 2.5H7.5C6 18 5 17 5 15.5v-7zm7 0c0-1.5 1-2.5 2.5-2.5H16c1.5 0 2.5 1 2.5 2.5v7c0 1.5-1 2.5-2.5 2.5h-1.5c-1.5 0-2.5-1-2.5-2.5v-7z"})}),s.jsx("span",{children:"HEIC"})]}),s.jsxs("a",{href:"https://space.bilibili.com/13818699",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-2 text-sm text-sky-600 dark:text-sky-400 hover:underline",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906L17.813 4.653zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773H5.333zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"})}),s.jsx("span",{children:"B: @Jim"})]})]})]}),s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:[" ",new Date().getFullYear()," Jim. "]})]})}),l&&s.jsx("div",{className:"fixed inset-0 flex items-center justify-center pointer-events-none",children:s.jsx("div",{className:"bg-black bg-opacity-75 text-white px-6 py-3 rounded-lg",children:" ESC "})}),s.jsx($s,{isOpen:S,onClose:()=>j(!1),darkMode:n,toggleDarkMode:e,syncZoom:i,toggleSyncZoom:o,images:a})]})})};en.createRoot(document.getElementById("root")).render(s.jsx(te.StrictMode,{children:s.jsx(Ws,{})}));
